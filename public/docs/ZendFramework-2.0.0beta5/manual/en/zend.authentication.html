<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 4. Zend\Authentication</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="prev" href="zend.acl.advanced.html" title="3.3. Advanced Usage">
<link rel="next" href="zend.authentication.adapter.dbtable.html" title="4.2. Database Table Authentication">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="article" href="learning.di.html" title="Learning Dependency Injection">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.acl.html" title="Chapter 3. Zend\Acl">
<link rel="chapter" href="zend.authentication.html" title="Chapter 4. Zend\Authentication">
<link rel="chapter" href="zend.barcode.html" title="Chapter 5. Zend\Barcode">
<link rel="chapter" href="zend.cache.html" title="Chapter 6. Zend\Cache">
<link rel="chapter" href="zend.captcha.html" title="Chapter 7. Zend\Captcha">
<link rel="chapter" href="zend.config.html" title="Chapter 8. Zend_Config">
<link rel="chapter" href="zend.crypt.html" title="Chapter 9. Zend_Crypt">
<link rel="chapter" href="zend.db.html" title="Chapter 10. Zend_Db">
<link rel="chapter" href="zend.di.html" title="Chapter 11. Zend\Di">
<link rel="chapter" href="zend.dom.html" title="Chapter 12. Zend\Dom">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 13. Zend\EventManager">
<link rel="chapter" href="zend.form.html" title="Chapter 14. Zend_Form">
<link rel="chapter" href="zend.http.html" title="Chapter 15. Zend_Http">
<link rel="chapter" href="zend.i18n.html" title="Chapter 16. Zend_I18n">
<link rel="chapter" href="zend.input-filter.html" title="Chapter 17. Zend\InputFilter">
<link rel="chapter" href="zend.ldap.html" title="Chapter 18. Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="Chapter 19. Zend\Loader">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.factory.html" title="factory">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.get-registered-autoloaders.html" title="getRegisteredAutoloaders">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.add-static-map.html" title="addStaticMap">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugins.html" title="registerPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-iterator.html" title="getIterator">
<link rel="refentry" href="zend.loader.short-name-locator.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.short-name-locator.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.short-name-locator.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-map.html" title="registerAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-maps.html" title="registerAutoloadMaps">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.get-autoload-map.html" title="getAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-fallback-autoloader.html" title="setFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.is-fallback-autoloader.html" title="isFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespace.html" title="registerNamespace">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespaces.html" title="registerNamespaces">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefix.html" title="registerPrefix">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefixes.html" title="registerPrefixes">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-static-paths.html" title="addStaticPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-paths.html" title="addPrefixPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-paths.html" title="getPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.clear-paths.html" title="clearPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-plugin-map.html" title="getPluginMap">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-map.html" title="getClassMap">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="chapter" href="zend.mail.html" title="Chapter 20. Zend\Mail">
<link rel="chapter" href="zend.module-manager.html" title="Chapter 21. Zend\ModuleManager">
<link rel="chapter" href="zend.mvc.html" title="Chapter 22. Zend\Mvc">
<link rel="chapter" href="zend.service-manager.html" title="Chapter 23. Zend\ServiceManager">
<link rel="chapter" href="zend.stdlib.html" title="Chapter 24. Zend\Stdlib">
<link rel="chapter" href="zend.uri.html" title="Chapter 25. Zend_Uri">
<link rel="chapter" href="zend.validator.html" title="Chapter 26. Zend\Validator">
<link rel="chapter" href="zend.view.html" title="Chapter 27. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Chapter 28. Zend_XmlRpc">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
<link rel="section" href="zend.authentication.html#zend.authentication.introduction" title="4.1. Introduction">
<link rel="section" href="zend.authentication.adapter.dbtable.html" title="4.2. Database Table Authentication">
<link rel="section" href="zend.authentication.adapter.digest.html" title="4.3. Digest Authentication">
<link rel="section" href="zend.authentication.adapter.http.html" title="4.4. HTTP Authentication Adapter">
<link rel="section" href="zend.authentication.adapter.ldap.html" title="4.5. LDAP Authentication">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 4. Zend\Authentication</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.acl.advanced.html">Prev</a> </td>
<th width="60%" align="center">Part III. Zend Framework Reference</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.authentication.adapter.dbtable.html">Next</a>
</td>
</tr>
</table></div>
<div class="chapter" title="Chapter 4. Zend\Authentication">
<div class="titlepage"><div><div><h2 class="title">
<a name="zend.authentication"></a>Chapter 4. Zend\Authentication</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction">4.1. Introduction</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction.adapters">4.1.1. Adapters</a></span></dt>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction.results">4.1.2. Results</a></span></dt>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction.persistence">4.1.3. Identity Persistence</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction.persistence.default">4.1.3.1. Default Persistence in the PHP Session</a></span></dt>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction.persistence.custom">4.1.3.2. Implementing Customized Storage</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.authentication.html#zend.authentication.introduction.using">4.1.4. Usage</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.authentication.adapter.dbtable.html">4.2. Database Table Authentication</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.adapter.dbtable.html#zend.authentication.adapter.dbtable.introduction">4.2.1. Introduction</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.dbtable.html#zend.authentication.adapter.dbtable.advanced.storing_result_row">4.2.2. Advanced Usage: Persisting a DbTable Result Object</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.dbtable.html#zend.authentication.adapter.dbtable.advanced.advanced_usage">4.2.3. Advanced Usage By Example</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.authentication.adapter.digest.html">4.3. Digest Authentication</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.adapter.digest.html#zend.authentication.adapter.digest.introduction">4.3.1. Introduction</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.digest.html#zend.authentication.adapter.digest.specifics">4.3.2. Specifics</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.digest.html#zend.authentication.adapter.digest.identity">4.3.3. Identity</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.authentication.adapter.http.html">4.4. HTTP Authentication Adapter</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.introduction">4.4.1. Introduction</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.http.html#zend.authentication.adapter.design_overview">4.4.2. Design Overview</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.http.html#zend.authentication.adapter.configuration_options">4.4.3. Configuration Options</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.resolvers">4.4.4. Resolvers</a></span></dt>
<dd><dl><dt><span class="section"><a href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.resolvers.file">4.4.4.1. File Resolver</a></span></dt></dl></dd>
<dt><span class="section"><a href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.basic_usage">4.4.5. Basic Usage</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html">4.5. LDAP Authentication</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.introduction">4.5.1. Introduction</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.usage">4.5.2. Usage</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.api">4.5.3. The API</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.server-options">4.5.4. Server Options</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.debugging">4.5.5. Collecting Debugging Messages</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.options-common-server-specific">4.5.6. Common Options for Specific Servers</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.options-common-server-specific.active-directory">4.5.6.1. Options for Active Directory</a></span></dt>
<dt><span class="section"><a href="zend.authentication.adapter.ldap.html#zend.authentication.adapter.ldap.options-common-server-specific.openldap">4.5.6.2. Options for OpenLDAP</a></span></dt>
</dl></dd>
</dl></dd>
</dl>
</div>
<div class="section" title="4.1. Introduction">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.authentication.introduction"></a>4.1. Introduction</h2></div></div></div>
<p>
        The <code class="classname">Zend\Authentication</code> component provides an <acronym class="acronym">API</acronym> for authentication and
        includes concrete authentication adapters for common use case scenarios.
    </p>
<p>
        <code class="classname">Zend\Authentication</code> is concerned only with <span class="emphasis"><em>authentication</em></span>
        and not with <span class="emphasis"><em>authorization</em></span>. Authentication is loosely defined as
        determining whether an entity actually is what it purports to be (i.e., identification),
        based on some set of credentials. Authorization, the process of deciding whether to allow
        an entity access to, or to perform operations upon, other entities is outside the scope of
        <code class="classname">Zend\Authentication</code>. For more information about authorization and access
        control with Zend Framework, please see the <a class="link" href="zend.acl.html" title="Chapter 3. Zend\Acl"><code class="classname">Zend\Acl</code></a> component.
    </p>
<div class="note" title="Note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
        There is no <code class="classname">Zend\Authentication\Authentication</code> class, instead the class 
        <code class="classname">Zend\Authentication\AuthenticationService</code> is provided. 
        This class uses underlying authentication adapters and persistent storage backends.
        </p></td></tr>
</table></div>
<div class="section" title="4.1.1. Adapters">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.introduction.adapters"></a>4.1.1. Adapters</h3></div></div></div>
<p>
            <code class="classname">Zend\Authentication</code> adapters are used to authenticate against a particular 
            type of authentication service, such as <acronym class="acronym">LDAP</acronym>,
            <acronym class="acronym">RDBMS</acronym>, or file-based storage. Different adapters are likely to have
            vastly different options and behaviors, but some basic things are common among
            authentication adapters. For example, accepting authentication credentials (including a
            purported identity), performing queries against the authentication service, and
            returning results are common to <code class="classname">Zend\Authentication</code> adapters.
        </p>
<p>
            Each <code class="classname">Zend\Authentication</code> adapter class implements
            <code class="classname">Zend\Authentication\Adapter\AdapterInterface</code>. This interface defines one method,
            <code class="methodname">authenticate()</code>, that an adapter class must implement for
            performing an authentication query. Each adapter class must be prepared prior to
            calling <code class="methodname">authenticate()</code>. Such adapter preparation includes
            setting up credentials (e.g., username and password) and defining values for
            adapter-specific configuration options, such as database connection settings for a
            database table adapter.
        </p>
<p>
            The following is an example authentication adapter that requires a username and
            password to be set for authentication. Other details, such as how the authentication
            service is queried, have been omitted for brevity:
        </p>
<pre class="programlisting">
use Zend\Authentication\Adapter\AdapterInterface;
        
class My\Auth\Adapter implements AdapterInterface
{
    /**
     * Sets username and password for authentication
     *
     * @return void
     */
    public function __construct($username, $password)
    {
        // ...
    }

    /**
     * Performs an authentication attempt
     *
     * @return \Zend\Authentication\Result
     * @throws \Zend\Authentication\Adapter\Exception\ExceptionInterface 
     *               If authentication cannot be performed
     */
    public function authenticate()
    {
        // ...
    }
}
</pre>
<p>
            As indicated in its docblock, <code class="methodname">authenticate()</code> must return an
            instance of <code class="classname">Zend\Authentication\Result</code> (or of a class derived from
            <code class="classname">Zend\Authentication\Result</code>). If for some reason performing an
            authentication query is impossible, <code class="methodname">authenticate()</code> should
            throw an exception that derives from
            <code class="classname">Zend\Authentication\Adapter\Exception\ExceptionInterface</code>.
        </p>
</div>
<div class="section" title="4.1.2. Results">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.introduction.results"></a>4.1.2. Results</h3></div></div></div>
<p>
            <code class="classname">Zend\Authentication</code> adapters return an instance of
            <code class="classname">Zend\Authentication\Result</code> with <code class="methodname">authenticate()</code> in
            order to represent the results of an authentication attempt. Adapters populate the
            <code class="classname">Zend\Authentication\Result</code> object upon construction, so that the following
            four methods provide a basic set of user-facing operations that are common to the
            results of <code class="classname">Zend\Authentication</code> adapters:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    <code class="methodname">isValid()</code> - returns <code class="constant">TRUE</code> if and
                    only if the result represents a successful authentication attempt
                </p></li>
<li class="listitem"><p>
                    <code class="methodname">getCode()</code> - returns a
                    <code class="classname">Zend\Authentication\Result</code> constant identifier for determining
                    the type of authentication failure or whether success has occurred. This
                    may be used in situations where the developer wishes to distinguish among
                    several authentication result types. This allows developers to maintain
                    detailed authentication result statistics, for example. Another use of this
                    feature is to provide specific, customized messages to users for usability
                    reasons, though developers are encouraged to consider the risks of
                    providing such detailed reasons to users, instead of a general
                    authentication failure message. For more information, see the notes below.
                </p></li>
<li class="listitem"><p>
                    <code class="methodname">getIdentity()</code> - returns the identity of the
                    authentication attempt
                </p></li>
<li class="listitem"><p>
                    <code class="methodname">getMessages()</code> - returns an array of messages
                    regarding a failed authentication attempt
                </p></li>
</ul></div>
<p>
            A developer may wish to branch based on the type of authentication result in order to
            perform more specific operations. Some operations developers might find useful are
            locking accounts after too many unsuccessful password attempts, flagging an IP address
            after too many nonexistent identities are attempted, and providing specific, customized
            authentication result messages to the user. The following result codes are available:
        </p>
<pre class="programlisting">
use Zend\Authentication\Result;

Result::SUCCESS
Result::FAILURE
Result::FAILURE_IDENTITY_NOT_FOUND
Result::FAILURE_IDENTITY_AMBIGUOUS
Result::FAILURE_CREDENTIAL_INVALID
Result::FAILURE_UNCATEGORIZED
</pre>
<p>
            The following example illustrates how a developer may branch on the result code:
        </p>
<pre class="programlisting">
// inside of AuthController / loginAction
$result = $this-&gt;_auth-&gt;authenticate($adapter);

switch ($result-&gt;getCode()) {

    case Zend_Auth_Result::FAILURE_IDENTITY_NOT_FOUND:
        /** do stuff for nonexistent identity **/
        break;

    case Zend_Auth_Result::FAILURE_CREDENTIAL_INVALID:
        /** do stuff for invalid credential **/
        break;

    case Zend_Auth_Result::SUCCESS:
        /** do stuff for successful authentication **/
        break;

    default:
        /** do stuff for other failure **/
        break;
}
</pre>
</div>
<div class="section" title="4.1.3. Identity Persistence">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.introduction.persistence"></a>4.1.3. Identity Persistence</h3></div></div></div>
<p>
            Authenticating a request that includes authentication credentials is useful per se, but
            it is also important to support maintaining the authenticated identity without having
            to present the authentication credentials with each request.
        </p>
<p>
            <acronym class="acronym">HTTP</acronym> is a stateless protocol, however, and techniques such as
            cookies and sessions have been developed in order to facilitate maintaining state
            across multiple requests in server-side web applications.
        </p>
<div class="section" title="4.1.3.1. Default Persistence in the PHP Session">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.authentication.introduction.persistence.default"></a>4.1.3.1. Default Persistence in the PHP Session</h4></div></div></div>
<p>
                 By default, <code class="classname">Zend\Authentication</code> provides persistent storage of the
                 identity from a successful authentication attempt using the <acronym class="acronym">PHP</acronym>
                 session. Upon a successful authentication attempt,
                 <code class="methodname">Zend\Authentication\AuthenticationService::authenticate()</code> stores the identity from the
                 authentication result into persistent storage. Unless specified otherwise,
                 <code class="classname">Zend\Authentication\AuthenticationService</code> uses a storage class named
                 <code class="classname">Zend\Authentication\Storage\Session</code>, which, in turn, uses
                 <a class="link" href=""><code class="classname">Zend\Session</code></a>. A custom
                 class may instead be used by providing an object that implements
                 <code class="classname">Zend\Authentication\Storage\StorageInterface</code> to
                 <code class="methodname">Zend\Authentication\AuthenticationService::setStorage()</code>.
            </p>
<div class="note" title="Note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
                    If automatic persistent storage of the identity is not appropriate for a
                    particular use case, then developers may forgot using the
                    <code class="classname">Zend\Authentication\AuthenticationService</code> class altogether, instead using an adapter
                    class directly.
                </p></td></tr>
</table></div>
<div class="example">
<a name="zend.authentication.introduction.persistence.default.example"></a><p class="title"><b>Example 4.1. Modifying the Session Namespace</b></p>
<div class="example-contents">
<p>
                    <code class="classname">Zend\Authentication\Storage\Session</code> uses a session namespace of
                    '<code class="classname">Zend_Auth</code>'. This namespace may be overridden by passing
                    a different value to the constructor of 
                    <code class="classname">Zend\Authentication\Storage\Session</code>, and this value is internally
                    passed along to the constructor of
                    <a class="link" href=""><code class="classname">Zend\Session\Container</code></a>. This should occur before
                    authentication is attempted, since
                    <code class="methodname">Zend\Authentication\AuthenticationService::authenticate()</code> performs the automatic
                    storage of the identity.
                </p>
<pre class="programlisting">
use Zend\Authentication\AuthenticationService,
    Zend\Authentication\Storage\Session as SessionStorage;

$auth = new AuthenticationService();

// Use 'someNamespace' instead of 'Zend_Auth'
$auth-&gt;setStorage(new SessionStorage('someNamespace'));

/**
 * @todo Set up the auth adapter, $authAdapter
 */

// Authenticate, saving the result, and persisting the identity on
// success
$result = $auth-&gt;authenticate($authAdapter);
</pre>
</div>
</div>
<br class="example-break">
</div>
<div class="section" title="4.1.3.2. Implementing Customized Storage">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.authentication.introduction.persistence.custom"></a>4.1.3.2. Implementing Customized Storage</h4></div></div></div>
<p>
                Sometimes developers may need to use a different identity storage mechanism than
                that provided by <code class="classname">Zend\Authentication\Storage\Session</code>. For such cases
                developers may simply implement <code class="classname">Zend\Authentication\Storage\StorageInterface</code>
                and supply an instance of the class to
                <code class="methodname">Zend\Authentication\AuthenticationService::setStorage()</code>.
            </p>
<div class="example">
<a name="zend.authentication.introduction.persistence.custom.example"></a><p class="title"><b>Example 4.2. Using a Custom Storage Class</b></p>
<div class="example-contents">
<p>
                    In order to use an identity persistence storage class other than
                    <code class="classname">Zend\Authentication\Storage\Session</code>, a developer implements
                    <code class="classname">Zend\Authentication\Storage\StorageInterface</code>:
                </p>
<pre class="programlisting">
use Zend\Authentication\Storage\StorageInterface;

class My\Storage implements StorageInterface
{
    /**
     * Returns true if and only if storage is empty
     *
     * @throws \Zend\Authentication\Exception\ExceptionInterface 
     *               If it is impossible to 
     *               determine whether storage is empty
     * @return boolean
     */
    public function isEmpty()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Returns the contents of storage
     *
     * Behavior is undefined when storage is empty.
     *
     * @throws \Zend\Authentication\Exception\ExceptionInterface 
     *               If reading contents from storage is impossible
     * @return mixed
     */

    public function read()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Writes $contents to storage
     *
     * @param  mixed $contents
     * @throws \Zend\Authentication\Exception\ExceptionInterface 
     *               If writing $contents to storage is impossible
     * @return void
     */

    public function write($contents)
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Clears contents from storage
     *
     * @throws \Zend\Authentication\Exception\ExceptionInterface 
     *               If clearing contents from storage is impossible
     * @return void
     */

    public function clear()
    {
        /**
         * @todo implementation
         */
    }
}
</pre>
<p>
                    In order to use this custom storage class,
                    <code class="methodname">Zend\Authentication\AuthenticationService::setStorage()</code> is invoked before an
                    authentication query is attempted:
                </p>
<pre class="programlisting">
use Zend\Authentication\AuthenticationService;

// Instruct AuthenticationService to use the custom storage class
$auth = new AuthenticationService();

$auth-&gt;setStorage(new My\Storage());

/**
 * @todo Set up the auth adapter, $authAdapter
 */

// Authenticate, saving the result, and persisting the identity on
// success
$result = $auth-&gt;authenticate($authAdapter);
</pre>
</div>
</div>
<br class="example-break">
</div>
</div>
<div class="section" title="4.1.4. Usage">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.introduction.using"></a>4.1.4. Usage</h3></div></div></div>
<p>
            There are two provided ways to use <code class="classname">Zend\Authentication</code> adapters:
        </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>
                    indirectly, through <code class="methodname">Zend\Authentication\AuthenticationService::authenticate()</code>
                </p></li>
<li class="listitem"><p>
                    directly, through the adapter's <code class="methodname">authenticate()</code> method
                </p></li>
</ol></div>
<p>
            The following example illustrates how to use a <code class="classname">Zend\Authentication</code> adapter
            indirectly, through the use of the <code class="classname">Zend\Authentication\AuthenticationService</code> class:
        </p>
<pre class="programlisting">
use Zend\Authentication\AuthenticationService;
        
// instantiate the authentication service
$auth = new AuthenticationService();

// Set up the authentication adapter
$authAdapter = new My\Auth\Adapter($username, $password);

// Attempt authentication, saving the result
$result = $auth-&gt;authenticate($authAdapter);

if (!$result-&gt;isValid()) {
    // Authentication failed; print the reasons why
    foreach ($result-&gt;getMessages() as $message) {
        echo "$message\n";
    }
} else {
    // Authentication succeeded; the identity ($username) is stored
    // in the session
    // $result-&gt;getIdentity() === $auth-&gt;getIdentity()
    // $result-&gt;getIdentity() === $username
}
</pre>
<p>
            Once authentication has been attempted in a request, as in the above example, it is a
            simple matter to check whether a successfully authenticated identity exists:
        </p>
<pre class="programlisting">
use Zend\Authentication\AuthenticationService;

$auth = new AuthenticationService();

/**
 * @todo Set up the auth adapter, $authAdapter
 */
 
if ($auth-&gt;hasIdentity()) {
    // Identity exists; get it
    $identity = $auth-&gt;getIdentity();
}
</pre>
<p>
            To remove an identity from persistent storage, simply use the
            <code class="methodname">clearIdentity()</code> method. This typically would be used for
            implementing an application "logout" operation:
        </p>
<pre class="programlisting">
$auth-&gt;clearIdentity();
</pre>
<p>
            When the automatic use of persistent storage is inappropriate for a particular use
            case, a developer may simply bypass the use of the <code class="classname">Zend\Authentication\AuthenticationService</code>
            class, using an adapter class directly. Direct use of an adapter class involves
            configuring and preparing an adapter object and then calling its
            <code class="methodname">authenticate()</code> method. Adapter-specific details are discussed
            in the documentation for each adapter. The following example directly utilizes
            <code class="classname">My\Auth\Adapter</code>:
        </p>
<pre class="programlisting">
// Set up the authentication adapter
$authAdapter = new My\Auth\Adapter($username, $password);

// Attempt authentication, saving the result
$result = $authAdapter-&gt;authenticate();

if (!$result-&gt;isValid()) {
    // Authentication failed; print the reasons why
    foreach ($result-&gt;getMessages() as $message) {
        echo "$message\n";
    }
} else {
    // Authentication succeeded
    // $result-&gt;getIdentity() === $username
}
</pre>
</div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.acl.advanced.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="reference.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.authentication.adapter.dbtable.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">3.3. Advanced Usage </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 4.2. Database Table Authentication</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
