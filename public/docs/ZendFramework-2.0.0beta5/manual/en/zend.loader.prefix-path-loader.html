<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>19.9. The PrefixPathLoader</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="zend.loader.html" title="Chapter 19. Zend\Loader">
<link rel="prev" href="zend.loader.classmap-generator.html" title="19.8. The Class Map Generator utility: bin/classmap_generator.php">
<link rel="next" href="zend.loader.prefix-path-loader.methods.constructor.html" title="__construct">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="article" href="learning.di.html" title="Learning Dependency Injection">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.acl.html" title="Chapter 3. Zend\Acl">
<link rel="chapter" href="zend.authentication.html" title="Chapter 4. Zend\Authentication">
<link rel="chapter" href="zend.barcode.html" title="Chapter 5. Zend\Barcode">
<link rel="chapter" href="zend.cache.html" title="Chapter 6. Zend\Cache">
<link rel="chapter" href="zend.captcha.html" title="Chapter 7. Zend\Captcha">
<link rel="chapter" href="zend.config.html" title="Chapter 8. Zend_Config">
<link rel="chapter" href="zend.crypt.html" title="Chapter 9. Zend_Crypt">
<link rel="chapter" href="zend.db.html" title="Chapter 10. Zend_Db">
<link rel="chapter" href="zend.di.html" title="Chapter 11. Zend\Di">
<link rel="chapter" href="zend.dom.html" title="Chapter 12. Zend\Dom">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 13. Zend\EventManager">
<link rel="chapter" href="zend.form.html" title="Chapter 14. Zend_Form">
<link rel="chapter" href="zend.http.html" title="Chapter 15. Zend_Http">
<link rel="chapter" href="zend.i18n.html" title="Chapter 16. Zend_I18n">
<link rel="chapter" href="zend.input-filter.html" title="Chapter 17. Zend\InputFilter">
<link rel="chapter" href="zend.ldap.html" title="Chapter 18. Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="Chapter 19. Zend\Loader">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.factory.html" title="factory">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.get-registered-autoloaders.html" title="getRegisteredAutoloaders">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.add-static-map.html" title="addStaticMap">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugins.html" title="registerPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-iterator.html" title="getIterator">
<link rel="refentry" href="zend.loader.short-name-locator.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.short-name-locator.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.short-name-locator.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-map.html" title="registerAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-maps.html" title="registerAutoloadMaps">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.get-autoload-map.html" title="getAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-fallback-autoloader.html" title="setFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.is-fallback-autoloader.html" title="isFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespace.html" title="registerNamespace">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespaces.html" title="registerNamespaces">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefix.html" title="registerPrefix">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefixes.html" title="registerPrefixes">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-static-paths.html" title="addStaticPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-paths.html" title="addPrefixPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-paths.html" title="getPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.clear-paths.html" title="clearPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-plugin-map.html" title="getPluginMap">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-map.html" title="getClassMap">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="chapter" href="zend.mail.html" title="Chapter 20. Zend\Mail">
<link rel="chapter" href="zend.module-manager.html" title="Chapter 21. Zend\ModuleManager">
<link rel="chapter" href="zend.mvc.html" title="Chapter 22. Zend\Mvc">
<link rel="chapter" href="zend.service-manager.html" title="Chapter 23. Zend\ServiceManager">
<link rel="chapter" href="zend.stdlib.html" title="Chapter 24. Zend\Stdlib">
<link rel="chapter" href="zend.uri.html" title="Chapter 25. Zend_Uri">
<link rel="chapter" href="zend.validator.html" title="Chapter 26. Zend\Validator">
<link rel="chapter" href="zend.view.html" title="Chapter 27. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Chapter 28. Zend_XmlRpc">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
<link rel="subsection" href="zend.loader.prefix-path-loader.html#zend.loader.prefix-path-loader.intro" title="19.9.1. Overview">
<link rel="subsection" href="zend.loader.prefix-path-loader.html#zend.loader.prefix-path-loader.quick-start" title="19.9.2. Quick Start">
<link rel="subsection" href="zend.loader.prefix-path-loader.html#zend.loader.prefix-path-loader.options" title="19.9.3. Configuration Options">
<link rel="subsection" href="zend.loader.prefix-path-loader.html#zend.loader.prefix-path-loader.methods" title="19.9.4. Available Methods">
<link rel="subsection" href="zend.loader.prefix-path-loader.html#zend.loader.prefix-path-loader.examples" title="19.9.5. Examples">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">19.9. The PrefixPathLoader</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.loader.classmap-generator.html">Prev</a> </td>
<th width="60%" align="center">Chapter 19. Zend\Loader</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.loader.prefix-path-loader.methods.constructor.html">Next</a>
</td>
</tr>
</table></div>
<div class="section" title="19.9. The PrefixPathLoader">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.loader.prefix-path-loader"></a>19.9. The PrefixPathLoader</h2></div></div></div>
<div class="section" title="19.9.1. Overview">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.prefix-path-loader.intro"></a>19.9.1. Overview</h3></div></div></div>
<p>
            Zend Framework's 1.X series introduced a plugin methodology surrounding associations of
            vendor/component prefixes and filesystem paths in the
            <code class="classname">Zend_Loader_PluginLoader</code> class. Zend Framework 2 provides
            equivalent functionality with the <code class="classname">PrefixPathLoader</code> class, and
            expands it to take advantage of PHP 5.3 namespaces.
        </p>
<p>
            The concept is relatively simple: a given vendor prefix or namespace is mapped to one or
            more paths, and multiple prefix/path maps may be provided. To resolve a plugin name, the
            prefixes are searched as a stack (i.e., last in, first out, or LIFO), and each path
            associated with the prefix is also searched as a stack. As soon as a file is found
            matching the plugin name, the class will be returned. 
        </p>
<p>
            Since searching through the filesystem can lead to performance degradation, the
            <code class="classname">PrefixPathLoader</code> provides several optimizations. First, it will
            attempt to autoload a plugin before scanning the filesystem. This allows you to benefit
            from your autoloader and/or an opcode cache. Second, it aggregates the class name and
            class file associated with each discovered plugin. You can then retrieve this
            information and cache it for later seeding a <a class="link" href="zend.loader.class-map-autoloader.html" title="19.6. The ClassMapAutoloader">ClassMapAutoloader</a> and 
            <a class="link" href="zend.loader.plugin-class-loader.html" title="19.2. The PluginClassLoader">PluginClassLoader</a>.
        </p>
<p>
            <code class="classname">PrefixPathLoader</code> implements the
            <code class="interfacename">ShortNameLocator</code> and
            <code class="interfacename">PrefixPathMapper</code> interfaces.
        </p>
<div class="note" title="Case Sensitivity"><table border="0" summary="Note: Case Sensitivity">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Case Sensitivity</th>
</tr>
<tr><td align="left" valign="top"><p>
                Unlike the <a class="link" href="zend.loader.plugin-class-loader.html" title="19.2. The PluginClassLoader">PluginClassLoader</a>,
                plugins resolved via the <code class="classname">PrefixPathLoader</code> are considered case
                sensitive. This is due to the fact that the lookup is done on the filesystem, and
                thus a file exactly matching the plugin name must exist.
            </p></td></tr>
</table></div>
<div class="note" title="Preference is for Namespaces"><table border="0" summary="Note: Preference is for Namespaces">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Preference is for Namespaces</th>
</tr>
<tr><td align="left" valign="top"><p>
                Unlike the Zend Framework 1 variant, the <code class="classname">PrefixPathLoader</code>
                assumes that "prefixes" are PHP 5.3 namespaces by default. You can override this
                behavior, however, per prefix/path you map. Please see the documentation and
                examples below for details.
            </p></td></tr>
</table></div>
</div>
<div class="section" title="19.9.2. Quick Start">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.prefix-path-loader.quick-start"></a>19.9.2. Quick Start</h3></div></div></div>
<p>
            The <code class="classname">PrefixPathLoader</code> invariably requires some configuration -- it
            needs to know what namespaces and/or vendor prefixes it should try, as well as the paths
            associated with each. You can inform the class of these at instantiation, or later by
            calling either the <code class="methodname">addPrefixPath()</code> or
            <code class="methodname">addPrefixPaths()</code> methods.
        </p>
<pre class="programlisting">
use Zend\Loader\PrefixPathLoader;

// Configure at instantiation:
$loader = new PrefixPathLoader(array(
    array('prefix' =&gt; 'Foo', 'path' =&gt; '../library/Foo'),
    array('prefix' =&gt; 'Bar', 'path' =&gt; '../vendor/Bar'),
));

// Or configure manually using methods:
$loader = new PrefixPathLoader();
$loader-&gt;addPrefixPath('Foo', '../library/Foo');

$loader-&gt;addPrefixPaths(array(
    array('prefix' =&gt; 'Foo', 'path' =&gt; '../library/Foo'),
    array('prefix' =&gt; 'Bar', 'path' =&gt; '../vendor/Bar'),
));
</pre>
<p>
            Once configured, you may then attempt to lookup a plugin.
        </p>
<pre class="programlisting">
if (false === ($class = $loader-&gt;load('bar'))) {
    throw new Exception("Plugin class matching 'bar' not found!");
}
$plugin = new $class();
</pre>
</div>
<div class="section" title="19.9.3. Configuration Options">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.prefix-path-loader.options"></a>19.9.3. Configuration Options</h3></div></div></div>
<div class="variablelist" title="PrefixPathLoader Options">
<p class="title"><b>PrefixPathLoader Options</b></p>
<dl>
<dt><span class="term">$options</span></dt>
<dd><p>
                        The constructor accepts either an array or a
                        <code class="interfacename">Traversable</code> object of prefix paths. For the
                        format allowed, please see the <a class="link" href="zend.loader.prefix-path-loader.methods.add-prefix-paths.html" title="addPrefixPaths">addPrefixPaths()</a>
                        method documentation.
                    </p></dd>
</dl>
</div>
</div>
<div class="section" title="19.9.4. Available Methods"><div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.prefix-path-loader.methods"></a>19.9.4. Available Methods</h3></div></div></div></div>
<div class="section" title="19.9.5. Examples">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.loader.prefix-path-loader.examples"></a>19.9.5. Examples</h3></div></div></div>
<div class="example">
<a name="zend.loader.prefix-path-loader.examples.multiple-paths"></a><p class="title"><b>Example 19.7. Using multiple paths for the same prefix</b></p>
<div class="example-contents">
<p>
                Sometimes you may have code containing the same namespace or vendor prefix in two
                different locations. Potentially, the same class may be defined in different
                locations, but with slightly different functionality. (We do not recommend this, but
                sometimes it happens.)
            </p>
<p>
                The <code class="classname">PrefixPathLoader</code> easily allows for these situations;
                simply register the path you want to take precedence last.
            </p>
<p>
                Consider the following directory structures:
            </p>
<pre class="programlisting">
project
|-- library
|   |-- Foo
|   |   |-- Bar.php
|   |   `-- Baz.php
|-- vendor
|   |-- Foo
|   |   |-- Bar.php
|   |   `-- Foobar.php
            </pre>
<p>
                For purposes of this example, we'll assume that the common namespace is "Foo", and
                that the "Bar" plugin from the vendor branch is preferred. To make this possible,
                simply register the "vendor" directory last.
            </p>
<pre class="programlisting">
use Zend\Loader\PrefixPathLoader;

$loader = new PrefixPathLoader();

// Multiple calls to addPrefixPath():
$loader-&gt;addPrefixPath('Foo', PROJECT_ROOT . '/library/Foo')
       -&gt;addPrefixPath('Foo', PROJECT_ROOT . '/vendor/Foo');

// Or use a single call to addPrefixPaths():
$loader-&gt;addPrefixPaths(array(
    array('prefix' =&gt; 'Foo', 'path' =&gt; PROJECT_ROOT . '/library/Foo'),
    array('prefix' =&gt; 'Foo', 'path' =&gt; PROJECT_ROOT . '/vendor/Foo'),
));

// And then resolve plugins:
$bar    = $loader-&gt;load('bar');    // Foo\Bar from vendor/Foo/Bar.php
$baz    = $loader-&gt;load('baz');    // Foo\Baz from library/Foo/Baz.php
$foobar = $loader-&gt;load('foobar'); // Foo\Foobar from vendor/Foo/Baz.php
</pre>
</div>
</div>
<br class="example-break"><div class="example">
<a name="zend.loader.prefix-path-loader.examples.optimizing"></a><p class="title"><b>Example 19.8. Prototyping with PrefixPathLoader</b></p>
<div class="example-contents">
<p>
                <code class="classname">PrefixPathLoader</code> is quite useful for prototyping
                applications. With minimal configuration, you can access a full directory of
                plugins, without needing to update maps as new plugins are added. However, this
                comes with a price: performance. Since plugins are resolved typically using by
                searching the filesystem, you are introducing I/O calls every time you request a new
                plugin.
            </p>
<p>
                With this in mind, <code class="classname">PrefixPathLoader</code> provides two methods for
                assisting in migrating to more performant solutions. The first is
                <code class="methodname">getClassMap()</code>. This method returns an array of class
                name/file name pairs suitable for use with <a class="link" href="zend.loader.class-map-autoloader.html" title="19.6. The ClassMapAutoloader">ClassMapAutoloader</a>. Injecting
                your autoloader with that map will ensure that on subsequent calls,
                <code class="methodname">load()</code> should be able to find the appropriate class via
                autoloading -- assuming that the match is on the first prefix checked.
            </p>
<p>
                The second solution is the <code class="methodname">getPluginMap()</code> method, which
                creates a plugin name/class name map suitable for injecting into a <a class="link" href="zend.loader.plugin-class-loader.html" title="19.2. The PluginClassLoader">PluginClassLoader</a> instance.
                Combine this with class map-based autoloading, and you can actually eliminate I/O
                calls altogether when using an opcode cache.
            </p>
<p>
                Usage of these methods is quite simple.
            </p>
<pre class="programlisting">
// After a number of load() operations, or at the end of the request:
$classMap  = $loader-&gt;getClassMap();
$pluginMap = $loader-&gt;getPluginMap();
</pre>
<p>
                From here, you will need to do a little work. First, you need to serialize this
                information somehow for later use. For that, there are two options:
                <code class="classname">Zend\Serializer</code> or <code class="classname">Zend\Cache</code>.
            </p>
<pre class="programlisting">
// Using Zend\Serializer:
use Zend\Serializer\Serializer;

$adapter = Serializer::factory('PhpCode');
$content = "&lt;?php\nreturn " . $adapter-&gt;serialize($classMap) . ";";
file_put_contents(APPLICATION_PATH . '/.classmap.php', $content);

// Using Zend\Cache:
use Zend\Cache\Cache;

$cache = Cache::factory(
    'Core', 'File', 
    array('lifetime' =&gt; null, 'automatic_serialization' =&gt; true),
    array('cache_dir' =&gt; APPLICATION_PATH . '/../cache/classmaps')
);
$cache-&gt;save($pluginMap, 'pluginmap');
</pre>
<p>
                Note: the examples alternate between the class map and plugin map; however, either
                technique applies to either map.
            </p>
<p>
                Once the data is cached, you can retrieve it late to populate. In the example of the
                class map above, you would simply pass the filename to the
                <code class="varname">ClassMapAutoloader</code> instance:
            </p>
<pre class="programlisting">
$autoloader = new Zend\Loader\ClassMapAutoloader();
$autoloader-&gt;registerAutoloadMap(APPLICATION_PATH . '/.classmap.php');
</pre>
<p>
                If using <code class="classname">Zend\Cache</code>, you would retrieve the cached data, and
                pass it to the appropriate component; in this case, we pass the value to a
                <code class="classname">PluginClassLoader</code> instance.
            </p>
<pre class="programlisting">
$map = $cache-&gt;load('pluginmap');

$loader = new Zend\Loader\PluginClassLoader($map);
</pre>
<p>
                With some creative and well disciplined architecture, you can likely automate these
                processes to ensure that development can benefit from the dynamic nature of the
                <code class="classname">PrefixPathLoader</code>, and production can benefit from the
                performance optimizations of the <code class="classname">ClassMapAutoloader</code> and
                <code class="classname">PluginClassLoader</code>.
            </p>
</div>
</div>
<br class="example-break">
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.loader.classmap-generator.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.loader.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.loader.prefix-path-loader.methods.constructor.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">19.8. The Class Map Generator utility: bin/classmap_generator.php </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> __construct</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
