<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>4.4. HTTP Authentication Adapter</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="zend.authentication.html" title="Chapter 4. Zend\Authentication">
<link rel="prev" href="zend.authentication.adapter.digest.html" title="4.3. Digest Authentication">
<link rel="next" href="zend.authentication.adapter.ldap.html" title="4.5. LDAP Authentication">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="article" href="learning.di.html" title="Learning Dependency Injection">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.acl.html" title="Chapter 3. Zend\Acl">
<link rel="chapter" href="zend.authentication.html" title="Chapter 4. Zend\Authentication">
<link rel="chapter" href="zend.barcode.html" title="Chapter 5. Zend\Barcode">
<link rel="chapter" href="zend.cache.html" title="Chapter 6. Zend\Cache">
<link rel="chapter" href="zend.captcha.html" title="Chapter 7. Zend\Captcha">
<link rel="chapter" href="zend.config.html" title="Chapter 8. Zend_Config">
<link rel="chapter" href="zend.crypt.html" title="Chapter 9. Zend_Crypt">
<link rel="chapter" href="zend.db.html" title="Chapter 10. Zend_Db">
<link rel="chapter" href="zend.di.html" title="Chapter 11. Zend\Di">
<link rel="chapter" href="zend.dom.html" title="Chapter 12. Zend\Dom">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 13. Zend\EventManager">
<link rel="chapter" href="zend.form.html" title="Chapter 14. Zend_Form">
<link rel="chapter" href="zend.http.html" title="Chapter 15. Zend_Http">
<link rel="chapter" href="zend.i18n.html" title="Chapter 16. Zend_I18n">
<link rel="chapter" href="zend.input-filter.html" title="Chapter 17. Zend\InputFilter">
<link rel="chapter" href="zend.ldap.html" title="Chapter 18. Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="Chapter 19. Zend\Loader">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.factory.html" title="factory">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.get-registered-autoloaders.html" title="getRegisteredAutoloaders">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.add-static-map.html" title="addStaticMap">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugins.html" title="registerPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-iterator.html" title="getIterator">
<link rel="refentry" href="zend.loader.short-name-locator.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.short-name-locator.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.short-name-locator.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-map.html" title="registerAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-maps.html" title="registerAutoloadMaps">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.get-autoload-map.html" title="getAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-fallback-autoloader.html" title="setFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.is-fallback-autoloader.html" title="isFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespace.html" title="registerNamespace">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespaces.html" title="registerNamespaces">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefix.html" title="registerPrefix">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefixes.html" title="registerPrefixes">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-static-paths.html" title="addStaticPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-paths.html" title="addPrefixPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-paths.html" title="getPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.clear-paths.html" title="clearPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-plugin-map.html" title="getPluginMap">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-map.html" title="getClassMap">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="chapter" href="zend.mail.html" title="Chapter 20. Zend\Mail">
<link rel="chapter" href="zend.module-manager.html" title="Chapter 21. Zend\ModuleManager">
<link rel="chapter" href="zend.mvc.html" title="Chapter 22. Zend\Mvc">
<link rel="chapter" href="zend.service-manager.html" title="Chapter 23. Zend\ServiceManager">
<link rel="chapter" href="zend.stdlib.html" title="Chapter 24. Zend\Stdlib">
<link rel="chapter" href="zend.uri.html" title="Chapter 25. Zend_Uri">
<link rel="chapter" href="zend.validator.html" title="Chapter 26. Zend\Validator">
<link rel="chapter" href="zend.view.html" title="Chapter 27. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Chapter 28. Zend_XmlRpc">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
<link rel="subsection" href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.introduction" title="4.4.1. Introduction">
<link rel="subsection" href="zend.authentication.adapter.http.html#zend.authentication.adapter.design_overview" title="4.4.2. Design Overview">
<link rel="subsection" href="zend.authentication.adapter.http.html#zend.authentication.adapter.configuration_options" title="4.4.3. Configuration Options">
<link rel="subsection" href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.resolvers" title="4.4.4. Resolvers">
<link rel="subsection" href="zend.authentication.adapter.http.html#zend.authentication.adapter.http.basic_usage" title="4.4.5. Basic Usage">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">4.4. HTTP Authentication Adapter</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.authentication.adapter.digest.html">Prev</a> </td>
<th width="60%" align="center">Chapter 4. Zend\Authentication</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.authentication.adapter.ldap.html">Next</a>
</td>
</tr>
</table></div>
<div class="section" title="4.4. HTTP Authentication Adapter">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.authentication.adapter.http"></a>4.4. HTTP Authentication Adapter</h2></div></div></div>
<div class="section" title="4.4.1. Introduction">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.adapter.http.introduction"></a>4.4.1. Introduction</h3></div></div></div>
<p>
            <code class="classname">Zend\Authentication\Adapter\Http</code> provides a mostly-compliant
            implementation of <a class="link" href="http://tools.ietf.org/html/rfc2617" target="_top">RFC-2617</a>,
            <a class="link" href="http://en.wikipedia.org/wiki/Basic_authentication_scheme" target="_top">Basic</a>
            and <a class="link" href="http://en.wikipedia.org/wiki/Digest_access_authentication" target="_top">Digest</a>
            <acronym class="acronym">HTTP</acronym> Authentication. Digest authentication is a method of
            <acronym class="acronym">HTTP</acronym> authentication that improves upon Basic authentication by
            providing a way to authenticate without having to transmit the password in clear text
            across the network.
        </p>
<p>
            <span class="emphasis"><em>Major Features:</em></span>
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    Supports both Basic and Digest authentication.
                </p></li>
<li class="listitem"><p>
                    Issues challenges in all supported schemes, so client can respond with any
                    scheme it supports.
                </p></li>
<li class="listitem"><p>
                    Supports proxy authentication.
                </p></li>
<li class="listitem"><p>
                    Includes support for authenticating against text files and provides an
                    interface for authenticating against other sources, such as databases.
                </p></li>
</ul></div>
<p>
            There are a few notable features of <acronym class="acronym">RFC-2617</acronym> that are not
            implemented yet:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    Nonce tracking, which would allow for "stale" support, and increased replay
                    attack protection.
                </p></li>
<li class="listitem"><p>
                    Authentication with integrity checking, or "auth-int".
                </p></li>
<li class="listitem"><p>
                    Authentication-Info <acronym class="acronym">HTTP</acronym> header.
                </p></li>
</ul></div>
</div>
<div class="section" title="4.4.2. Design Overview">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.adapter.design_overview"></a>4.4.2. Design Overview</h3></div></div></div>
<p>
            This adapter consists of two sub-components, the <acronym class="acronym">HTTP</acronym> authentication
            class itself, and the so-called "Resolvers." The <acronym class="acronym">HTTP</acronym> authentication
            class encapsulates the logic for carrying out both Basic and Digest authentication. It
            uses a Resolver to look up a client's identity in some data store (text file by
            default), and retrieve the credentials from the data store. The "resolved" credentials
            are then compared to the values submitted by the client to determine whether
            authentication is successful.
        </p>
</div>
<div class="section" title="4.4.3. Configuration Options">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.adapter.configuration_options"></a>4.4.3. Configuration Options</h3></div></div></div>
<p>
            The <code class="classname">Zend\Authentication\Adapter\Http</code> class requires a configuration array
            passed to its constructor. There are several configuration options available, and some
            are required:
        </p>
<div class="table">
<a name="zend.authentication.adapter.configuration_options.table"></a><p class="title"><b>Table 4.1. Configuration Options</b></p>
<div class="table-contents"><table summary="Configuration Options" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>Option Name</th>
<th>Required</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><span class="emphasis"><em><span class="property">accept_schemes</span></em></span></td>
<td>Yes</td>
<td>
                            Determines which authentication schemes the adapter will accept from
                            the client. Must be a space-separated list containing
                            <span class="emphasis"><em>'basic'</em></span> and/or <span class="emphasis"><em>'digest'</em></span>.
                        </td>
</tr>
<tr>
<td><span class="emphasis"><em><span class="property">realm</span></em></span></td>
<td>Yes</td>
<td>
                            Sets the authentication realm; usernames should be unique within a
                            given realm.
                        </td>
</tr>
<tr>
<td><span class="emphasis"><em><span class="property">digest_domains</span></em></span></td>
<td>
                            Yes, when <span class="property">accept_schemes</span> contains
                            <span class="emphasis"><em>digest</em></span>
                        </td>
<td>
                            Space-separated list of <acronym class="acronym">URI</acronym>s for which the same
                            authentication information is valid. The <acronym class="acronym">URI</acronym>s need
                            not all point to the same server.
                        </td>
</tr>
<tr>
<td><span class="emphasis"><em><span class="property">nonce_timeout</span></em></span></td>
<td>
                            Yes, when <span class="property">accept_schemes</span> contains
                            <span class="emphasis"><em>digest</em></span>
                        </td>
<td>
                            Sets the number of seconds for which the nonce is valid. See notes
                            below.
                        </td>
</tr>
<tr>
<td><span class="emphasis"><em><span class="property">use_opaque</span></em></span></td>
<td>No</td>
<td>
                            Specifies whether to send the opaque value in the header. True by default.
                        </td>
</tr>
<tr>
<td><span class="emphasis"><em><span class="property">algorithm</span></em></span></td>
<td>No</td>
<td>
                            Specified the algorithm. Defaults to MD5, the only supported option (for now).
                        </td>
</tr>
<tr>
<td><span class="emphasis"><em><span class="property">proxy_auth</span></em></span></td>
<td>No</td>
<td>
                            Disabled by default. Enable to perform Proxy authentication, instead
                            of normal origin server authentication.
                        </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><div class="note" title="Note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
                The current implementation of the <span class="property">nonce_timeout</span> has some
                interesting side effects. This setting is supposed to determine the valid lifetime
                of a given nonce, or effectively how long a client's authentication information is
                accepted. Currently, if it's set to 3600 (for example), it will cause the adapter
                to prompt the client for new credentials every hour, on the hour. This will be
                resolved in a future release, once nonce tracking and stale support are
                implemented.
            </p></td></tr>
</table></div>
</div>
<div class="section" title="4.4.4. Resolvers">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.adapter.http.resolvers"></a>4.4.4. Resolvers</h3></div></div></div>
<p>
            The resolver's job is to take a username and realm, and return some kind of credential
            value. Basic authentication expects to receive the Base64 encoded version of the user's
            password. Digest authentication expects to receive a hash of the user's username, the
            realm, and their password (each separated by colons). Currently, the only supported
            hash algorithm is <acronym class="acronym">MD5</acronym>.
        </p>
<p>
            <code class="classname">Zend\Authentication\Adapter\Http</code> relies on objects implementing
            <code class="classname">Zend\Authentication\Adapter\Http\ResolverInterface</code>. A text file resolver
            class is included with this adapter, but any other kind of resolver can be created
            simply by implementing the resolver interface.
        </p>
<div class="section" title="4.4.4.1. File Resolver">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.authentication.adapter.http.resolvers.file"></a>4.4.4.1. File Resolver</h4></div></div></div>
<p>
                The file resolver is a very simple class. It has a single property specifying a
                filename, which can also be passed to the constructor. Its
                <code class="methodname">resolve()</code> method walks through the text file, searching
                for a line with a matching username and realm. The text file format similar to
                Apache htpasswd files:
            </p>
<pre class="programlisting">
&lt;username&gt;:&lt;realm&gt;:&lt;credentials&gt;\n
</pre>
<p>
                Each line consists of three fields - username, realm, and credentials - each
                separated by a colon. The credentials field is opaque to the file resolver; it
                simply returns that value as-is to the caller. Therefore, this same file format
                serves both Basic and Digest authentication. In Basic authentication, the
                credentials field should be written in clear text. In Digest authentication, it
                should be the <acronym class="acronym">MD5</acronym> hash described above.
            </p>
<p>
                There are two equally easy ways to create a File resolver:
            </p>
<pre class="programlisting">
use Zend\Authentication\Adapter\Http\FileResolver;
$path     = 'files/passwd.txt';
$resolver = new FileResolver($path);
</pre>
<p>
                or
            </p>
<pre class="programlisting">
$path     = 'files/passwd.txt';
$resolver = new FileResolver();
$resolver-&gt;setFile($path);
</pre>
<p>
                If the given path is empty or not readable, an exception is thrown.
            </p>
</div>
</div>
<div class="section" title="4.4.5. Basic Usage">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.authentication.adapter.http.basic_usage"></a>4.4.5. Basic Usage</h3></div></div></div>
<p>
            First, set up an array with the required configuration values:
        </p>
<pre class="programlisting">
$config = array(
    'accept_schemes' =&gt; 'basic digest',
    'realm'          =&gt; 'My Web Site',
    'digest_domains' =&gt; '/members_only /my_account',
    'nonce_timeout'  =&gt; 3600,
);
</pre>
<p>
            This array will cause the adapter to accept either Basic or Digest authentication, and
            will require authenticated access to all the areas of the site under
            <code class="filename">/members_only</code> and <code class="filename">/my_account</code>. The realm
            value is usually displayed by the browser in the password dialog box. The
            <span class="property">nonce_timeout</span>, of course, behaves as described above.
        </p>
<p>
            Next, create the <code class="classname">Zend\Authentication\Adapter\Http</code> object:
        </p>
<pre class="programlisting">
$adapter = new Zend\Authentication\Adapter\Http($config);
</pre>
<p>
            Since we're supporting both Basic and Digest authentication, we need two different
            resolver objects. Note that this could just as easily be two different classes:
        </p>
<pre class="programlisting">
use Zend\Authentication\Adapter\Http\FileResolver;

$basicResolver = new FileResolver();
$basicResolver-&gt;setFile('files/basicPasswd.txt');

$digestResolver = new FileResolver();
$digestResolver-&gt;setFile('files/digestPasswd.txt');

$adapter-&gt;setBasicResolver($basicResolver);
$adapter-&gt;setDigestResolver($digestResolver);
</pre>
<p>
            Finally, we perform the authentication. The adapter needs a reference to both the
            Request and Response objects in order to do its job:
        </p>
<pre class="programlisting">
assert($request instanceof Zend\Http\Request);
assert($response instanceof Zend\Http\Response);

$adapter-&gt;setRequest($request);
$adapter-&gt;setResponse($response);

$result = $adapter-&gt;authenticate();
if (!$result-&gt;isValid()) {
    // Bad userame/password, or canceled password prompt
}
</pre>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.authentication.adapter.digest.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.authentication.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.authentication.adapter.ldap.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">4.3. Digest Authentication </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 4.5. LDAP Authentication</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
