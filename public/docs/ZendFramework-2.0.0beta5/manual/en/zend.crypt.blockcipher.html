<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>9.2. Encrypt/decrypt using block ciphers</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="zend.crypt.html" title="Chapter 9. Zend_Crypt">
<link rel="prev" href="zend.crypt.html" title="Chapter 9. Zend_Crypt">
<link rel="next" href="zend.crypt.key.derivation.html" title="9.3. Key derivation function">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="article" href="learning.di.html" title="Learning Dependency Injection">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.acl.html" title="Chapter 3. Zend\Acl">
<link rel="chapter" href="zend.authentication.html" title="Chapter 4. Zend\Authentication">
<link rel="chapter" href="zend.barcode.html" title="Chapter 5. Zend\Barcode">
<link rel="chapter" href="zend.cache.html" title="Chapter 6. Zend\Cache">
<link rel="chapter" href="zend.captcha.html" title="Chapter 7. Zend\Captcha">
<link rel="chapter" href="zend.config.html" title="Chapter 8. Zend_Config">
<link rel="chapter" href="zend.crypt.html" title="Chapter 9. Zend_Crypt">
<link rel="chapter" href="zend.db.html" title="Chapter 10. Zend_Db">
<link rel="chapter" href="zend.di.html" title="Chapter 11. Zend\Di">
<link rel="chapter" href="zend.dom.html" title="Chapter 12. Zend\Dom">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 13. Zend\EventManager">
<link rel="chapter" href="zend.form.html" title="Chapter 14. Zend_Form">
<link rel="chapter" href="zend.http.html" title="Chapter 15. Zend_Http">
<link rel="chapter" href="zend.i18n.html" title="Chapter 16. Zend_I18n">
<link rel="chapter" href="zend.input-filter.html" title="Chapter 17. Zend\InputFilter">
<link rel="chapter" href="zend.ldap.html" title="Chapter 18. Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="Chapter 19. Zend\Loader">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.factory.html" title="factory">
<link rel="refentry" href="zend.loader.autoloader-factory.methods.get-registered-autoloaders.html" title="getRegisteredAutoloaders">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.add-static-map.html" title="addStaticMap">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.register-plugins.html" title="registerPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-loader.methods.get-iterator.html" title="getIterator">
<link rel="refentry" href="zend.loader.short-name-locator.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.short-name-locator.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.short-name-locator.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.register-plugin.html" title="registerPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.unregister-plugin.html" title="unregisterPlugin">
<link rel="refentry" href="zend.loader.plugin-class-locator.methods.get-registered-plugins.html" title="getRegisteredPlugins">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.spl-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-map.html" title="registerAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register-autoload-maps.html" title="registerAutoloadMaps">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.get-autoload-map.html" title="getAutoloadMap">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.class-map-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.set-fallback-autoloader.html" title="setFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.is-fallback-autoloader.html" title="isFallbackAutoloader">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespace.html" title="registerNamespace">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-namespaces.html" title="registerNamespaces">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefix.html" title="registerPrefix">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register-prefixes.html" title="registerPrefixes">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.autoload.html" title="autoload">
<link rel="refentry" href="zend.loader.standard-autoloader.methods.register.html" title="register">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.constructor.html" title="__construct">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-static-paths.html" title="addStaticPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.set-options.html" title="setOptions">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.add-prefix-paths.html" title="addPrefixPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-paths.html" title="getPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.clear-paths.html" title="clearPaths">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.is-loaded.html" title="isLoaded">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-name.html" title="getClassName">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.load.html" title="load">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-plugin-map.html" title="getPluginMap">
<link rel="refentry" href="zend.loader.prefix-path-loader.methods.get-class-map.html" title="getClassMap">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.add-prefix-path.html" title="addPrefixPath">
<link rel="refentry" href="zend.loader.prefix-path-mapper.methods.remove-prefix-path.html" title="removePrefixPath">
<link rel="chapter" href="zend.mail.html" title="Chapter 20. Zend\Mail">
<link rel="chapter" href="zend.module-manager.html" title="Chapter 21. Zend\ModuleManager">
<link rel="chapter" href="zend.mvc.html" title="Chapter 22. Zend\Mvc">
<link rel="chapter" href="zend.service-manager.html" title="Chapter 23. Zend\ServiceManager">
<link rel="chapter" href="zend.stdlib.html" title="Chapter 24. Zend\Stdlib">
<link rel="chapter" href="zend.uri.html" title="Chapter 25. Zend_Uri">
<link rel="chapter" href="zend.validator.html" title="Chapter 26. Zend\Validator">
<link rel="chapter" href="zend.view.html" title="Chapter 27. Zend_View">
<link rel="chapter" href="zend.xmlrpc.html" title="Chapter 28. Zend_XmlRpc">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">9.2. Encrypt/decrypt using block ciphers</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.crypt.html">Prev</a> </td>
<th width="60%" align="center">Chapter 9. Zend_Crypt</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.crypt.key.derivation.html">Next</a>
</td>
</tr>
</table></div>
<div class="section" title="9.2. Encrypt/decrypt using block ciphers">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.crypt.blockcipher"></a>9.2. Encrypt/decrypt using block ciphers</h2></div></div></div>
<p>
        <code class="classname">Zend\Crypt\BlockCipher</code> implements the encrypt-then-authenticate mode using <a class="link" href="http://en.wikipedia.org/wiki/HMAC" target="_top">HMAC</a> to provide authentication.
    </p>
<p>
        The symmetric cipher can be choose with a specific adapter that implements the <code class="classname">Zend\Crypt\Symmetric\SymmetricInterface</code>.
        We support the standard algorithms of the <a class="link" href="http://php.net/manual/en/book.mcrypt.php" target="_top">Mcrypt</a> extension. The adapter that implements the Mcrypt is <code class="classname">Zend\Crypt\Symmetric\Mcrypt</code>.
    </p>
<p>
        In the following code we reported an example on how to use the BlockCipher class to encrypt-then-authenticate
        a string using the <a class="link" href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_top">AES</a> block cipher (with a key of 256 bit) and the HMAC algorithm (using the <a class="link" href="http://en.wikipedia.org/wiki/SHA-2" target="_top">SHA-256</a> hash function).
    </p>
<pre class="programlisting">
use Zend\Crypt\BlockCipher;

$blockCipher = BlockCipher::factory('mcrypt', array('algo' =&gt; 'aes'));
$blockCipher-&gt;setKey('encryption key');
$result = $blockCipher-&gt;encrypt('this is a secret message');
echo "Encrypted text: $result \n";
</pre>
<p>
        The BlockCipher is initialized using a factory method with the name of the cipher adapter to use (mcrypt)
        and the parameters to pass to the adapter (the AES algorithm). In order to encrypt a string we need to specify an
        encryption key and we used the <code class="methodname">setKey()</code> method for that scope. The encryption is provided by the <code class="methodname">encrypt()</code> method.
    </p>
<p>
        The output of the encryption is a string, encoded in Base64 (default), that contains the HMAC value, the IV vector, and
        the encrypted text. The encryption mode used is the <a class="link" href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Cipher-block_chaining_.28CBC.29" target="_top">CBC</a>
        (default with random <a class="link" href="http://en.wikipedia.org/wiki/Initialization_vector" target="_top">IV</a>) and the hash algorithm of HMAC is SHA256 (default).
        The Mcrypt adapter encrypts using the <a class="link" href="http://en.wikipedia.org/wiki/Padding_%28cryptography%29" target="_top">PKCS#7 padding</a> mechanism by default. You can specify a different padding technique
        using a special adapter for that (Zend\Crypt\Symmetric\Padding). The encryption key and the authentication key for HMAC are
        generated using the <a class="link" href="http://en.wikipedia.org/wiki/PBKDF2" target="_top">PBKDF2</a> algorithm as key derivation function.
    </p>
<div class="note" title="Key size"><table border="0" summary="Note: Key size">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Key size</th>
</tr>
<tr><td align="left" valign="top"><p>
            The BlockCipher class uses always the longest size of the key, for a particular cipher.
            For instance, for the AES algorithm it uses 256 bits and for the <a class="link" href="http://en.wikipedia.org/wiki/Blowfish_%28cipher%29" target="_top">Blowfish</a> algorithm it uses 448 bits.
        </p></td></tr>
</table></div>
<p>
        You can change all the default settings passing the values to the factory parameters.
        For instance, if you want to use the Blowfish algorithm, with the CFB mode and the SHA512 hash function for HMAC you have to initialize the class as follow:
    </p>
<pre class="programlisting">
use Zend\Crypt\BlockCipher;

$blockCipher = BlockCipher::factory('mcrypt', array(
                                'algo' =&gt; 'blowfish',
                                'mode' =&gt; 'cfb',
                                'hash' =&gt; 'sha512'
                            ));
</pre>
<div class="note" title="Recommendation"><table border="0" summary="Note: Recommendation">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td>
<th align="left">Recommendation</th>
</tr>
<tr><td align="left" valign="top"><p>
            If you are not familiar with symmetric encryption techniques we strongly suggest to use the default values of the <code class="classname">BlockCipher</code> class.
            The default values are: AES algorithm, CBC mode, HMAC with SHA256, PKCS#7 padding.
        </p></td></tr>
</table></div>
<p>
        To decrypt a string we can use the <code class="methodname">decrypt()</code> method. In order to successfully decrypt a string we have to
        configure the BlockCipher with the same parameters of the encryption. In the previous example that means to
        reuse the AES algorithm with the same encryption key.
    </p>
<p>
        We can also initialize the BlockCipher manually without use the factory method. We can inject the symmetric cipher adapter
        directly to the constructor of the BlockCipher class. For instance, we can rewrite the previous example as follow:
    </p>
<pre class="programlisting">
use Zend\Crypt\BlockCipher,
    Zend\Crypt\Symmetric\Mcrypt;

$blockCipher = new BlockCipher(new Mcrypt(array('algo' =&gt; 'aes'));
$blockCipher-&gt;setKey('encryption key');
$result = $blockCipher-&gt;encrypt('this is a secret message');
echo "Encrypted text: $result \n";
</pre>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.crypt.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.crypt.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.crypt.key.derivation.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 9. Zend_Crypt </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 9.3. Key derivation function</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
