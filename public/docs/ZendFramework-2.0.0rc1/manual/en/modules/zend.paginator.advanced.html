

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Advanced usage &mdash; Zend Framework 2 2.0.0beta5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0beta5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Zend Framework 2 2.0.0beta5 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Zend Framework 2 2.0.0beta5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="advanced-usage">
<span id="zend-paginator-advanced"></span><h1>Advanced usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="custom-data-source-adapters">
<span id="zend-paginator-advanced-adapters"></span><h2>Custom data source adapters<a class="headerlink" href="#custom-data-source-adapters" title="Permalink to this headline">¶</a></h2>
<p>At some point you may run across a data type that is not covered by the packaged adapters. In this case, you will
need to write your own.</p>
<p>To do so, you must implement <tt class="docutils literal"><span class="pre">Zend_Paginator_Adapter_Interface</span></tt>. There are two methods required to do this:</p>
<ul class="simple">
<li>count()</li>
<li>getItems($offset, $itemCountPerPage)</li>
</ul>
<p>Additionally, you&#8217;ll want to implement a constructor that takes your data source as a parameter and stores it as a
protected or private property. How you wish to go about doing this specifically is up to you.</p>
<p>If you&#8217;ve ever used the SPL interface <a class="reference external" href="http://www.php.net/~helly/php/ext/spl/interfaceCountable.html">Countable</a>, you&#8217;re familiar with <tt class="docutils literal"><span class="pre">count()</span></tt>. As used with
<tt class="docutils literal"><span class="pre">Zend_Paginator</span></tt>, this is the total number of items in the data collection. Additionally, the <tt class="docutils literal"><span class="pre">Zend_Paginator</span></tt>
instance provides a method <tt class="docutils literal"><span class="pre">countAllItems()</span></tt> that proxies to the adapter <tt class="docutils literal"><span class="pre">count()</span></tt> method.</p>
<p>The <tt class="docutils literal"><span class="pre">getItems()</span></tt> method is only slightly more complicated. For this, your adapter is supplied with an offset and
the number of items to display per page. You must return the appropriate slice of data. For an array, that would
be:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">return</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_array</span><span class="p">,</span> <span class="nv">$offset</span><span class="p">,</span> <span class="nv">$itemCountPerPage</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>Take a look at the packaged adapters (all of which implement the <tt class="docutils literal"><span class="pre">Zend_Paginator_Adapter_Interface</span></tt>) for ideas of
how you might go about implementing your own.</p>
</div>
<div class="section" id="custom-scrolling-styles">
<span id="zend-paginator-advanced-scrolling-styles"></span><h2>Custom scrolling styles<a class="headerlink" href="#custom-scrolling-styles" title="Permalink to this headline">¶</a></h2>
<p>Creating your own scrolling style requires that you implement <tt class="docutils literal"><span class="pre">Zend_Paginator_ScrollingStyle_Interface</span></tt>, which
defines a single method, <tt class="docutils literal"><span class="pre">getPages()</span></tt>. Specifically,</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">getPages</span><span class="p">(</span><span class="nx">Zend_Paginator</span> <span class="nv">$paginator</span><span class="p">,</span> <span class="nv">$pageRange</span> <span class="o">=</span> <span class="k">null</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>This method should calculate a lower and upper bound for page numbers within the range of so-called &#8220;local&#8221; pages
(that is, pages that are nearby the current page).</p>
<p>Unless it extends another scrolling style (see <tt class="docutils literal"><span class="pre">Zend_Paginator_ScrollingStyle_Elastic</span></tt> for an example), your
custom scrolling style will inevitably end with something similar to the following line of code:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">return</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getPagesInRange</span><span class="p">(</span><span class="nv">$lowerBound</span><span class="p">,</span> <span class="nv">$upperBound</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>There&#8217;s nothing special about this call; it&#8217;s merely a convenience method to check the validity of the lower and
upper bound and return an array of the range to the paginator.</p>
<p>When you&#8217;re ready to use your new scrolling style, you&#8217;ll need to tell <tt class="docutils literal"><span class="pre">Zend_Paginator</span></tt> what directory to look
in. To do that, do the following:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$prefix</span> <span class="o">=</span> <span class="s1">&#39;My_Paginator_ScrollingStyle&#39;</span><span class="p">;</span>
<span class="nv">$path</span>   <span class="o">=</span> <span class="s1">&#39;My/Paginator/ScrollingStyle/&#39;</span><span class="p">;</span>
<span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">addScrollingStylePrefixPath</span><span class="p">(</span><span class="nv">$prefix</span><span class="p">,</span> <span class="nv">$path</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="caching-features">
<span id="zend-paginator-advanced-caching"></span><h2>Caching features<a class="headerlink" href="#caching-features" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">Zend_Paginator</span></tt> can be told to cache the data it has already passed on, preventing the adapter from fetching
them each time they are used. To tell paginator to automatically cache the adapter&#8217;s data, just pass to its
<tt class="docutils literal"><span class="pre">setCache()</span></tt> method a <tt class="docutils literal"><span class="pre">Zend_Cache_Core</span></tt> instance.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$paginator</span> <span class="o">=</span> <span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$someData</span><span class="p">);</span>
<span class="nv">$fO</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;lifetime&#39;</span> <span class="o">=&gt;</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;automatic_serialization&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">);</span>
<span class="nv">$bO</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;cache_dir&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;/tmp&#39;</span><span class="p">);</span>
<span class="nv">$cache</span> <span class="o">=</span> <span class="nx">Zend_cache</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="s1">&#39;Core&#39;</span><span class="p">,</span> <span class="s1">&#39;File&#39;</span><span class="p">,</span> <span class="nv">$fO</span><span class="p">,</span> <span class="nv">$bO</span><span class="p">);</span>
<span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">setCache</span><span class="p">(</span><span class="nv">$cache</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>As far as <tt class="docutils literal"><span class="pre">Zend_Paginator</span></tt> has got a <tt class="docutils literal"><span class="pre">Zend_Cache_Core</span></tt> instance, data will be cached. Sometimes you would like
not to cache data even if you already passed a cache instance. You should then use <tt class="docutils literal"><span class="pre">setCacheEnable()</span></tt> for that.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$paginator</span> <span class="o">=</span> <span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$someData</span><span class="p">);</span>
<span class="c1">// $cache is a Zend_Cache_Core instance</span>
<span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">setCache</span><span class="p">(</span><span class="nv">$cache</span><span class="p">);</span>
<span class="c1">// ... later on the script</span>
<span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">setCacheEnable</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="c1">// cache is now disabled</span>
</pre></div>
</td></tr></table></div>
<p>When a cache is set, data are automatically stored in it and pulled out from it. It then can be useful to empty the
cache manually. You can get this done by calling <tt class="docutils literal"><span class="pre">clearPageItemCache($pageNumber)</span></tt>. If you don&#8217;t pass any
parameter, the whole cache will be empty. You can optionally pass a parameter representing the page number to empty
in the cache:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$paginator</span> <span class="o">=</span> <span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$someData</span><span class="p">);</span>
<span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">setCache</span><span class="p">(</span><span class="nv">$cache</span><span class="p">);</span>
<span class="nv">$items</span> <span class="o">=</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getCurrentItems</span><span class="p">();</span>
<span class="c1">// page 1 is now in cache</span>
<span class="nv">$page3Items</span> <span class="o">=</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getItemsByPage</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="c1">// page 3 is now in cache</span>

<span class="c1">// clear the cache of the results for page 3</span>
<span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">clearPageItemCache</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// clear all the cache data</span>
<span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">clearPageItemCache</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<p>Changing the item count per page will empty the whole cache as it would have become invalid:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$paginator</span> <span class="o">=</span> <span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$someData</span><span class="p">);</span>
<span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">setCache</span><span class="p">(</span><span class="nv">$cache</span><span class="p">);</span>
<span class="c1">// fetch some items</span>
<span class="nv">$items</span> <span class="o">=</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getCurrentItems</span><span class="p">();</span>

<span class="c1">// all the cache data will be flushed:</span>
<span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">setItemCountPerPage</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>It is also possible to see the data in cache and ask for them directly. <tt class="docutils literal"><span class="pre">getPageItemCache()</span></tt> can be used for
that:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$paginator</span> <span class="o">=</span> <span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$someData</span><span class="p">);</span>
<span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">setItemCountPerPage</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">Zend_Paginator</span><span class="o">::</span><span class="na">setCache</span><span class="p">(</span><span class="nv">$cache</span><span class="p">);</span>

<span class="c1">// fetch some items</span>
<span class="nv">$items</span> <span class="o">=</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getCurrentItems</span><span class="p">();</span>
<span class="nv">$otherItems</span> <span class="o">=</span> <span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getItemsPerPage</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c1">// see the cached items as a two-dimension array:</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$paginator</span><span class="o">-&gt;</span><span class="na">getPageItemCache</span><span class="p">());</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="zend-paginator-adapteraggregate-interface">
<span id="zend-paginator-advanced-aggregator"></span><h2>Zend_Paginator_AdapterAggregate Interface<a class="headerlink" href="#zend-paginator-adapteraggregate-interface" title="Permalink to this headline">¶</a></h2>
<p>Depending on your application you might want to paginate objects, whose internal data-structure is equal to
existing adapters, but you don&#8217;t want to break up your encapsulation to allow access to this data. In other cases
an object might be in a &#8220;has-an adapter&#8221; relationship, rather than the &#8220;is-an adapter&#8221; relationsship that
<tt class="docutils literal"><span class="pre">Zend_Paginator_Adapter_Abstract</span></tt> promotes. For this cases you can use the <tt class="docutils literal"><span class="pre">Zend_Paginator_AdapterAggregate</span></tt>
interface that behaves much like the <tt class="docutils literal"><span class="pre">IteratorAggregate</span></tt> interface of the <em>PHP</em> SPL extension.</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">interface</span> <span class="nx">Zend_Paginator_AdapterAggregate</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Return a fully configured Paginator Adapter from this method.</span>
<span class="sd">     *</span>
<span class="sd">     * @return Zend_Paginator_Adapter_Abstract</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPaginatorAdapter</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The interface is fairly small and only expects you to return an instance of <tt class="docutils literal"><span class="pre">Zend_Paginator_Adapter_Abstract</span></tt>. An
Adapter Aggregate instance is then recognized by both <tt class="docutils literal"><span class="pre">Zend_Paginator::factory()</span></tt> and the constructor of
<tt class="docutils literal"><span class="pre">Zend_Paginator</span></tt> and handled accordingly.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/zf2_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced usage</a><ul>
<li><a class="reference internal" href="#custom-data-source-adapters">Custom data source adapters</a></li>
<li><a class="reference internal" href="#custom-scrolling-styles">Custom scrolling styles</a></li>
<li><a class="reference internal" href="#caching-features">Caching features</a></li>
<li><a class="reference internal" href="#zend-paginator-adapteraggregate-interface">Zend_Paginator_AdapterAggregate Interface</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/modules/zend.paginator.advanced.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Zend Framework 2 2.0.0beta5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Zend Technologies Ltd..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>