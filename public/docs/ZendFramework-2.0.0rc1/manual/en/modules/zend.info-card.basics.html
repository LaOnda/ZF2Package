

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; Zend Framework 2 2.0.0beta5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0beta5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Zend Framework 2 2.0.0beta5 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Zend Framework 2 2.0.0beta5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction">
<span id="zend-infocard-basics"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>The <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component implements relying-party support for Information Cards. Information Cards are used for identity management on the internet and authentication of users to web sites. The web sites that the user ultimately authenticates to are called <strong>relying-parties</strong>.</p>
<p>Detailed information about information cards and their importance to the internet identity metasystem can be found on the <a class="reference external" href="http://www.identityblog.com/">IdentityBlog</a>.</p>
<div class="section" id="basic-theory-of-usage">
<span id="zend-infocard-basics-theory"></span><h2>Basic Theory of Usage<a class="headerlink" href="#basic-theory-of-usage" title="Permalink to this headline">¶</a></h2>
<p>Usage of <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> can be done one of two ways: either as part of the larger <tt class="docutils literal"><span class="pre">Zend_Auth</span></tt> component via the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> authentication adapter or as a stand-alone component. In both cases an information card can be requested from a user by using the following <em>HTML</em> block in your <em>HTML</em> login form:</p>
<div class="highlight-html"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;http://example.com/server&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&#39;image&#39;</span> <span class="na">src=</span><span class="s">&#39;/images/ic.png&#39;</span> <span class="na">align=</span><span class="s">&#39;center&#39;</span>
        <span class="na">width=</span><span class="s">&#39;120px&#39;</span> <span class="na">style=</span><span class="s">&#39;cursor:pointer&#39;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;object</span> <span class="na">type=</span><span class="s">&quot;application/x-informationCard&quot;</span>
          <span class="na">name=</span><span class="s">&quot;xmlToken&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;tokenType&quot;</span>
         <span class="na">value=</span><span class="s">&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;requiredClaims&quot;</span>
         <span class="na">value=</span><span class="s">&quot;http://.../claims/privatepersonalidentifier</span>
<span class="s">         http://.../claims/givenname</span>
<span class="s">         http://.../claims/surname&quot;</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;/object&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</td></tr></table></div>
<p>In the example above, the <tt class="docutils literal"><span class="pre">requiredClaims</span></tt> &lt;param&gt; tag is used to identify pieces of information known as claims (i.e. person&#8217;s first name, last name) which the web site (a.k.a &#8220;relying party&#8221;) needs in order a user to authenticate using an information card. For your reference, the full <em>URI</em> (for instance the <strong>givenname</strong> claim) is as follows: <tt class="docutils literal"><span class="pre">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname</span></tt></p>
<p>When the above <em>HTML</em> is activated by a user (clicks on it), the browser will bring up a card selection program which not only shows them which information cards meet the requirements of the site, but also allows them to select which information card to use if multiple meet the criteria. This information card is transmitted as an <em>XML</em> document to the specified POST <em>URL</em> and is ready to be processed by the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component.</p>
<p>Note, Information cards can only be <em>HTTP</em> <em>POST</em>ed to <em>SSL</em>-encrypted <em>URL</em>s. Please consult your web server&#8217;s documentation on how to set up <em>SSL</em> encryption.</p>
</div>
<div class="section" id="using-as-part-of-zend-auth">
<span id="zend-infocard-basics-auth"></span><h2>Using as part of Zend_Auth<a class="headerlink" href="#using-as-part-of-zend-auth" title="Permalink to this headline">¶</a></h2>
<p>In order to use the component as part of the <tt class="docutils literal"><span class="pre">Zend_Auth</span></tt> authentication system, you must use the provided <tt class="docutils literal"><span class="pre">Zend_Auth_Adapter_InfoCard</span></tt> to do so (not available in the standalone <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> distribution). An example of its usage is shown below:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]))</span> <span class="p">{</span>

    <span class="nv">$adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend_Auth_Adapter_InfoCard</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]);</span>

    <span class="nv">$adapter</span><span class="o">-&gt;</span><span class="na">addCertificatePair</span><span class="p">(</span><span class="s1">&#39;/usr/local/Zend/apache2/conf/server.key&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;/usr/local/Zend/apache2/conf/server.crt&#39;</span><span class="p">);</span>

    <span class="nv">$auth</span> <span class="o">=</span> <span class="nx">Zend_Auth</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>

    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$auth</span><span class="o">-&gt;</span><span class="na">authenticate</span><span class="p">(</span><span class="nv">$adapter</span><span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">Zend_Auth_Result</span><span class="o">::</span><span class="na">SUCCESS</span><span class="o">:</span>
            <span class="nv">$claims</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getIdentity</span><span class="p">();</span>
            <span class="k">print</span> <span class="s2">&quot;Given Name: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">givenname</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
            <span class="k">print</span> <span class="s2">&quot;Surname: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">surname</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
            <span class="k">print</span> <span class="s2">&quot;Email Address: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">emailaddress</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
            <span class="k">print</span> <span class="s2">&quot;PPI: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">getCardID</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">Zend_Auth_Result</span><span class="o">::</span><span class="na">FAILURE_CREDENTIAL_INVALID</span><span class="o">:</span>
            <span class="k">print</span> <span class="s2">&quot;The Credential you provided did not pass validation&quot;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
        <span class="k">case</span> <span class="nx">Zend_Auth_Result</span><span class="o">::</span><span class="na">FAILURE</span><span class="o">:</span>
            <span class="k">print</span> <span class="s2">&quot;There was an error processing your credentials.&quot;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">&quot;&lt;pre&gt;&quot;</span><span class="p">;</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getMessages</span><span class="p">());</span>
        <span class="k">print</span> <span class="s2">&quot;&lt;/pre&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;hr /&gt;</span>
<span class="x">&lt;div id=&quot;login&quot; style=&quot;font-family: arial; font-size: 2em;&quot;&gt;</span>
<span class="x">&lt;p&gt;Simple Login Demo&lt;/p&gt;</span>
<span class="x"> &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">  &lt;input type=&quot;submit&quot; value=&quot;Login&quot; /&gt;</span>
<span class="x">   &lt;object type=&quot;application/x-informationCard&quot; name=&quot;xmlToken&quot;&gt;</span>
<span class="x">    &lt;param name=&quot;tokenType&quot;</span>
<span class="x">          value=&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot; /&gt;</span>
<span class="x">    &lt;param name=&quot;requiredClaims&quot;</span>
<span class="x">          value=&quot;http://.../claims/givenname</span>
<span class="x">                 http://.../claims/surname</span>
<span class="x">                 http://.../claims/emailaddress</span>
<span class="x">                 http://.../claims/privatepersonalidentifier&quot; /&gt;</span>
<span class="x">  &lt;/object&gt;</span>
<span class="x"> &lt;/form&gt;</span>
<span class="x">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p>In the example above, we first create an instance of the <tt class="docutils literal"><span class="pre">Zend_Auth_Adapter_InfoCard</span></tt> and pass the <em>XML</em> data posted by the card selector into it. Once an instance has been created you must then provide at least one <em>SSL</em> certificate public/private key pair used by the web server that received the <em>HTTP</em> <em>POST</em>. These files are used to validate the destination of the information posted to the server and are a requirement when using Information Cards.</p>
<p>Once the adapter has been configured, you can then use the standard <tt class="docutils literal"><span class="pre">Zend_Auth</span></tt> facilities to validate the provided information card token and authenticate the user by examining the identity provided by the <tt class="docutils literal"><span class="pre">getIdentity()</span></tt> method.</p>
</div>
<div class="section" id="using-the-zend-infocard-component-standalone">
<span id="zend-infocard-basics-standalone"></span><h2>Using the Zend_InfoCard component standalone<a class="headerlink" href="#using-the-zend-infocard-component-standalone" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to use the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component as a standalone component by interacting with the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> class directly. Using the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> class is very similar to its use with the <tt class="docutils literal"><span class="pre">Zend_Auth</span></tt> component. An example of its use is shown below:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$infocard</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend_InfoCard</span><span class="p">();</span>
    <span class="nv">$infocard</span><span class="o">-&gt;</span><span class="na">addCertificatePair</span><span class="p">(</span><span class="s1">&#39;/usr/local/Zend/apache2/conf/server.key&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;/usr/local/Zend/apache2/conf/server.crt&#39;</span><span class="p">);</span>

    <span class="nv">$claims</span> <span class="o">=</span> <span class="nv">$infocard</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]);</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">&quot;Given Name: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">givenname</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
        <span class="k">print</span> <span class="s2">&quot;Surname: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">surname</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
        <span class="k">print</span> <span class="s2">&quot;Email Address: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">emailaddress</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
        <span class="k">print</span> <span class="s2">&quot;PPI: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">getCardID</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;br /&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s2">&quot;Error Validating identity: </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">getErrorMsg</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;hr /&gt;</span>
<span class="x">&lt;div id=&quot;login&quot; style=&quot;font-family: arial; font-size: 2em;&quot;&gt;</span>
<span class="x"> &lt;p&gt;Simple Login Demo&lt;/p&gt;</span>
<span class="x"> &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">  &lt;input type=&quot;submit&quot; value=&quot;Login&quot; /&gt;</span>
<span class="x">   &lt;object type=&quot;application/x-informationCard&quot; name=&quot;xmlToken&quot;&gt;</span>
<span class="x">    &lt;param name=&quot;tokenType&quot;</span>
<span class="x">          value=&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot; /&gt;</span>
<span class="x">    &lt;param name=&quot;requiredClaims&quot;</span>
<span class="x">          value=&quot;http://.../claims/givenname</span>
<span class="x">                 http://.../claims/surname</span>
<span class="x">                 http://.../claims/emailaddress</span>
<span class="x">                 http://.../claims/privatepersonalidentifier&quot; /&gt;</span>
<span class="x">   &lt;/object&gt;</span>
<span class="x"> &lt;/form&gt;</span>
<span class="x">&lt;/div&gt;</span>
</pre></div>
</td></tr></table></div>
<p>In the example above, we use the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component independently to validate the token provided by the user. As was the case with the <tt class="docutils literal"><span class="pre">Zend_Auth_Adapter_InfoCard</span></tt>, we create an instance of <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> and then set one or more <em>SSL</em> certificate public/private key pairs used by the web server. Once configured, we can use the <tt class="docutils literal"><span class="pre">process()</span></tt> method to process the information card and return the results.</p>
</div>
<div class="section" id="working-with-a-claims-object">
<span id="zend-infocard-basics-claims"></span><h2>Working with a Claims object<a class="headerlink" href="#working-with-a-claims-object" title="Permalink to this headline">¶</a></h2>
<p>Regardless of whether the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component is used as a standalone component or as part of <tt class="docutils literal"><span class="pre">Zend_Auth</span></tt> via <tt class="docutils literal"><span class="pre">Zend_Auth_Adapter_InfoCard</span></tt>, the ultimate result of the processing of an information card is a <tt class="docutils literal"><span class="pre">Zend_InfoCard_Claims</span></tt> object. This object contains the assertions (a.k.a. claims) made by the submitting user based on the data requested by your web site when the user authenticated. As shown in the examples above, the validity of the information card can be ascertained by calling the <tt class="docutils literal"><span class="pre">Zend_InfoCard_Claims::isValid()</span></tt> method. Claims themselves can either be retrieved by simply accessing the identifier desired (i.e. <tt class="docutils literal"><span class="pre">givenname</span></tt>) as a property of the object or through the <tt class="docutils literal"><span class="pre">getClaim()</span></tt> method.</p>
<p>In most cases you will never need to use the <tt class="docutils literal"><span class="pre">getClaim()</span></tt> method. However, if your <tt class="docutils literal"><span class="pre">requiredClaims</span></tt> mandate that you request claims from multiple different sources/namespaces then you will need to extract them explicitly using this method (simply pass it the full <em>URI</em> of the claim to retrieve its value from within the information card). Generally speaking however, the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component will set the default <em>URI</em> for claims to be the one used the most frequently within the information card itself and the simplified property-access method can be used.</p>
<p>As part of the validation process, it is the developer&#8217;s responsibility to examine the issuing source of the claims contained within the information card and to decide if that source is a trusted source of information. To do so, the <tt class="docutils literal"><span class="pre">getIssuer()</span></tt> method is provided within the <tt class="docutils literal"><span class="pre">Zend_InfoCard_Claims</span></tt> object which returns the <em>URI</em> of the issuer of the information card claims.</p>
</div>
<div class="section" id="attaching-information-cards-to-existing-accounts">
<span id="zend-infocard-basics-attaching"></span><h2>Attaching Information Cards to existing accounts<a class="headerlink" href="#attaching-information-cards-to-existing-accounts" title="Permalink to this headline">¶</a></h2>
<p>It is possible to add support for information cards to an existing authentication system by storing the private personal identifier (PPI) to a previously traditionally-authenticated account and including at least the <tt class="docutils literal"><span class="pre">http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier</span></tt> claim as part of the <tt class="docutils literal"><span class="pre">requiredClaims</span></tt> of the request. If this claim is requested then the <tt class="docutils literal"><span class="pre">Zend_InfoCard_Claims</span></tt> object will provide a unique identifier for the specific card that was submitted by calling the <tt class="docutils literal"><span class="pre">getCardID()</span></tt> method.</p>
<p>An example of how to attach an information card to an existing traditional-authentication account is shown below:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1">// ...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">submitinfocardAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">ZBlog_Exception</span><span class="p">(</span><span class="s1">&#39;Expected an encrypted token &#39;</span> <span class="o">.</span>
                                  <span class="s1">&#39;but was not provided&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$infoCard</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend_InfoCard</span><span class="p">();</span>
    <span class="nv">$infoCard</span><span class="o">-&gt;</span><span class="na">addCertificatePair</span><span class="p">(</span><span class="nx">SSL_CERTIFICATE_PRIVATE</span><span class="p">,</span>
                                  <span class="nx">SSL_CERTIFICATE_PUB</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$claims</span> <span class="o">=</span> <span class="nv">$infoCard</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$request</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Zend_InfoCard_Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// TODO Error processing your request</span>
        <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$db</span> <span class="o">=</span> <span class="nx">ZBlog_Data</span><span class="o">::</span><span class="na">getAdapter</span><span class="p">();</span>

        <span class="nv">$ppi</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">getCardID</span><span class="p">());</span>
        <span class="nv">$fullname</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">quote</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">givenname</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nv">$claims</span><span class="o">-&gt;</span><span class="na">surname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>

        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE blogusers</span>
<span class="s2">                     SET ppi = </span><span class="si">$ppi</span><span class="s2">,</span>
<span class="s2">                         real_name = </span><span class="si">$fullname</span><span class="s2"></span>
<span class="s2">                   WHERE username=&#39;administrator&#39;&quot;</span><span class="p">;</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// TODO Failed to store in DB</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span>
            <span class="nx">ZBlog_Exception</span><span class="p">(</span><span class="s2">&quot;Infomation card failed security checks&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="creating-zend-infocard-adapters">
<span id="zend-infocard-basics-adapters"></span><h2>Creating Zend_InfoCard Adapters<a class="headerlink" href="#creating-zend-infocard-adapters" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> component was designed to allow for growth in the information card standard through the use of a modular architecture. At this time, many of these hooks are unused and can be ignored, but there is one class that should be written for any serious information card implementation: the <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> adapter.</p>
<p>The <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> adapter is used as a callback mechanism within the component to perform various tasks, such as storing and retrieving Assertion IDs for information cards when they are processed by the component. While storing the assertion IDs of submitted information cards is not necessary, failing to do so opens up the possibility of the authentication scheme being compromised through a replay attack.</p>
<p>To prevent this, one must implement the <tt class="docutils literal"><span class="pre">Zend_InfoCard_Adapter_Interface</span></tt> and set an instance of this interface prior to calling either the <tt class="docutils literal"><span class="pre">process()</span></tt> (standalone) or <tt class="docutils literal"><span class="pre">authenticate()</span></tt> method as a <tt class="docutils literal"><span class="pre">Zend_Auth</span></tt> adapter. To set this interface, the <tt class="docutils literal"><span class="pre">setAdapter()</span></tt> method should be used. In the example below, we set a <tt class="docutils literal"><span class="pre">Zend_InfoCard</span></tt> adapter and use it in our application:</p>
<div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">myAdapter</span> <span class="k">implements</span> <span class="nx">Zend_InfoCard_Adapter_Interface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">storeAssertion</span><span class="p">(</span><span class="nv">$assertionURI</span><span class="p">,</span>
                                   <span class="nv">$assertionID</span><span class="p">,</span>
                                   <span class="nv">$conditions</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* Store the assertion and its conditions by ID and URI */</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">retrieveAssertion</span><span class="p">(</span><span class="nv">$assertionURI</span><span class="p">,</span> <span class="nv">$assertionID</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* Retrieve the assertion by URI and ID */</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeAssertion</span><span class="p">(</span><span class="nv">$assertionURI</span><span class="p">,</span> <span class="nv">$assertionID</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* Delete a given assertion by URI/ID */</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$adapter</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">myAdapter</span><span class="p">();</span>

<span class="nv">$infoCard</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Zend_InfoCard</span><span class="p">();</span>
<span class="nv">$infoCard</span><span class="o">-&gt;</span><span class="na">addCertificatePair</span><span class="p">(</span><span class="nx">SSL_PRIVATE</span><span class="p">,</span> <span class="nx">SSL_PUB</span><span class="p">);</span>
<span class="nv">$infoCard</span><span class="o">-&gt;</span><span class="na">setAdapter</span><span class="p">(</span><span class="nv">$adapter</span><span class="p">);</span>

<span class="nv">$claims</span> <span class="o">=</span> <span class="nv">$infoCard</span><span class="o">-&gt;</span><span class="na">process</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;xmlToken&#39;</span><span class="p">]);</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/zf2_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#basic-theory-of-usage">Basic Theory of Usage</a></li>
<li><a class="reference internal" href="#using-as-part-of-zend-auth">Using as part of Zend_Auth</a></li>
<li><a class="reference internal" href="#using-the-zend-infocard-component-standalone">Using the Zend_InfoCard component standalone</a></li>
<li><a class="reference internal" href="#working-with-a-claims-object">Working with a Claims object</a></li>
<li><a class="reference internal" href="#attaching-information-cards-to-existing-accounts">Attaching Information Cards to existing accounts</a></li>
<li><a class="reference internal" href="#creating-zend-infocard-adapters">Creating Zend_InfoCard Adapters</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/modules/zend.info-card.basics.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Zend Framework 2 2.0.0beta5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Zend Technologies Ltd..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>