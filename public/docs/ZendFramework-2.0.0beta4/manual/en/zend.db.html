<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 6. Zend_Db</title>
<link rel="stylesheet" type="text/css" href="dbstyle.css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="prev" href="zend.crypt.password.html" title="5.4. Password secure storing">
<link rel="next" href="zend.db.sql.html" title="6.2. Zend\Db\Sql">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="article" href="learning.di.html" title="Learning Dependency Injection">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.cache.html" title="Chapter 3. Zend\Cache">
<link rel="chapter" href="zend.config.html" title="Chapter 4. Zend_Config">
<link rel="chapter" href="zend.crypt.html" title="Chapter 5. Zend_Crypt">
<link rel="chapter" href="zend.db.html" title="Chapter 6. Zend_Db">
<link rel="chapter" href="zend.di.html" title="Chapter 7. Zend\Di">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 8. Zend\EventManager">
<link rel="chapter" href="zend.form.html" title="Chapter 9. Zend_Form">
<link rel="chapter" href="zend.http.html" title="Chapter 10. Zend_Http">
<link rel="chapter" href="zend.input-filter.html" title="Chapter 11. Zend\InputFilter">
<link rel="chapter" href="zend.ldap.html" title="Chapter 12. Zend_Ldap">
<link rel="chapter" href="zend.loader.html" title="Chapter 13. Zend_Loader">
<link rel="chapter" href="zend.mail.html" title="Chapter 14. Zend\Mail">
<link rel="chapter" href="zend.module-manager.html" title="Chapter 15. Zend\ModuleManager">
<link rel="chapter" href="zend.mvc.html" title="Chapter 16. Zend\Mvc">
<link rel="chapter" href="zend.service-manager.html" title="Chapter 17. Zend\ServiceManager">
<link rel="chapter" href="zend.stdlib.html" title="Chapter 18. Zend\Stdlib">
<link rel="chapter" href="zend.uri.html" title="Chapter 19. Zend_Uri">
<link rel="chapter" href="zend.view.html" title="Chapter 20. Zend_View">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
<link rel="section" href="zend.db.html#zend.db.adapter" title="6.1. Zend\Db\Adapter">
<link rel="section" href="zend.db.sql.html" title="6.2. Zend\Db\Sql">
<link rel="section" href="zend.db.tablegateway.html" title="6.3. Zend\Db\TableGateway">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 6. Zend_Db</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.crypt.password.html">Prev</a> </td>
<th width="60%" align="center">Part III. Zend Framework Reference</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.db.sql.html">Next</a>
</td>
</tr>
</table></div>
<div class="chapter" title="Chapter 6. Zend_Db">
<div class="titlepage"><div><div><h2 class="title">
<a name="zend.db"></a>Chapter 6. Zend_Db</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter">6.1. Zend\Db\Adapter</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.quickstart">6.1.1. Creating an Adapter (Quickstart)</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.instantiating">6.1.2. Creating an Adapter (By Injecting Dependencies)</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.query-preparing">6.1.3. Query Preparation Through Zend\Db\Adapter\Adapter::query()</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.query-execution">6.1.4. Query Execution Through Zend\Db\Adapter\Adapter::query()</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.statement-creation">6.1.5. Creating Statements</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.platform">6.1.6. Using The Platform Object</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.parameter-container">6.1.7. Using The Parameter Container</a></span></dt>
<dt><span class="section"><a href="zend.db.html#zend.db.adapter.parameter-container.examples">6.1.8. Examples</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.db.sql.html">6.2. Zend\Db\Sql</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.sql">6.2.1. Zend\Db\Sql\Sql (Quickstart)</a></span></dt>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.sql-objects">6.2.2. Zend\Db\Sql's Select, Insert, Update and Delete</a></span></dt>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.select">6.2.3. Zend\Db\Sql\Select</a></span></dt>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.insert">6.2.4. Zend\Db\Sql\Insert</a></span></dt>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.update">6.2.5. Zend\Db\Sql\Update</a></span></dt>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.delete">6.2.6. Zend\Db\Sql\Delete</a></span></dt>
<dt><span class="section"><a href="zend.db.sql.html#zend.db.sql.where">6.2.7. Zend\Db\Sql\Where &amp; Zend\Db\Sql\Having</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.db.tablegateway.html">6.3. Zend\Db\TableGateway</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example">6.3.1. Examples</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.select">6.3.1.1. Selecting Rows</a></span></dt>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.insert">6.3.1.2. Inserting Rows</a></span></dt>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.update">6.3.1.3. Updating Rows</a></span></dt>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.delete">6.3.1.4. Deleting Rows</a></span></dt>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.select-with-where">6.3.1.5. Using a Fluent Where With Select</a></span></dt>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.select-with-closure">6.3.1.6. Using a Closure With Select</a></span></dt>
<dt><span class="section"><a href="zend.db.tablegateway.html#zend.db.tablegateway.by-example.row-gateway">6.3.1.7. Row Gateway Integration</a></span></dt>
</dl></dd>
</dl></dd>
</dl>
</div>
<div class="section" title="6.1. Zend\Db\Adapter">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.db.adapter"></a>6.1. Zend\Db\Adapter</h2></div></div></div>
<p>
        The Adapter object is the most important sub-component of Zend\Db.
        It is responsible for adapting any code written in or for Zend\Db
        to the targeted php extensions and vendor databases.  In doing this,
        it creates an abstraction layer for the PHP extensions, which is called
        the "Driver" portion of the Zend\Db adapter.  It also creates a lightweight
        abstraction layer for the various idiosyncrasies that each vendor specific
        platform might have in it's SQL/RDBMS implementation which is called the
        "Platform" portion of the adapter.
    </p>
<div class="section" title="6.1.1. Creating an Adapter (Quickstart)">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.quickstart"></a>6.1.1. Creating an Adapter (Quickstart)</h3></div></div></div>
<p>
            Creating an adapter can simply be done by instantiating the
            Zend\Db\Adapter\Adapter class.  The most common use case, while not the
            most explicit, is to pass an array of information to the Adapter.
        </p>
<pre class="programlisting">
            $adapter = new Zend\Db\Adapter\Adapter($driverArray);
</pre>
<p>
            This driver array is an abstraction for the extension level required
            parameters.  Here is a table for the
        </p>
<div class="table">
<a name="idp5615392"></a><p class="title"><b>Table 6.1. Connection Array Keys</b></p>
<div class="table-contents"><table summary="Connection Array Keys" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>Name</th>
<th>Required</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr>
<td>
	                        driver
	                    </td>
<td>
	                        required
	                    </td>
<td>
	                        Mysqli, Sqlsrv, Pdo_Sqlite, Pdo_Mysql, Pdo-OtherPdoDriver
	                    </td>
</tr>
<tr>
<td>
	                        database
	                    </td>
<td>
	                        generally required
	                    </td>
<td>
	                        the name of the database (schema)
	                    </td>
</tr>
<tr>
<td>
	                        username
	                    </td>
<td>
	                        generally required
	                    </td>
<td>
	                        the connection username
	                    </td>
</tr>
<tr>
<td>
	                        password
	                    </td>
<td>
	                        generally required
	                    </td>
<td>
	                        the connection password
	                    </td>
</tr>
<tr>
<td>
	                        hostname
	                    </td>
<td>
	                        not generally required
	                    </td>
<td>
	                        the IP address or hostname to connect to
	                    </td>
</tr>
<tr>
<td>
	                        port
	                    </td>
<td>
	                        not generally required
	                    </td>
<td>
	                        not generally required  the port to connect to (if applicable)
	                    </td>
</tr>
<tr>
<td>
	                        characterset
	                    </td>
<td>
	                        not generally required
	                    </td>
<td>
	                        not generally required  the character set to use
	                    </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
            * other names will work as well.  Effectively, if the PHP manual
            uses a particular naming, this naming will be supported by our Driver.
            For example, dbname in most cases will also work for 'database'.  Another
            example is that in the case of Sqlsrv, UID will work in place of username.
            Which format you chose is up to you, but the above table represents the
            official abstraction names.
         </p>
<p>
            So, for example, a MySQL connection using ext/mysqli:
        </p>
<pre class="programlisting">
            $adapter = new Zend\Db\Adapter\Adapter(array(
                'driver' =&gt; 'Mysqli',
                'database' =&gt; 'zend_db_example',
                'username' =&gt; 'developer',
                'password' =&gt; 'developer-password'
            ));
</pre>
<p>
            Another example, of a Sqlite connection via PDO:
        </p>
<pre class="programlisting">
            $adapter = new Zend\Db\Adapter\Adapter(array(
                'driver' =&gt; 'Pdo_Sqlite',
                'database' =&gt; 'path/to/sqlite.db'
            ));
</pre>
<p>
            It is important to know that by using this style of adapter creation, the Adapter
            will attempt to create any dependencies that were not explicitly provided.  A Driver
            object will be created from the contents of the $driver array provided in the
            constructor. A Platform object will be created based off the type of Driver object
            that was instantiated.  And lastly, a default ResultSet object is created and utilized.
            Any of these objects can be injected, to do this, see the next section.
        </p>
</div>
<div class="section" title="6.1.2. Creating an Adapter (By Injecting Dependencies)">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.instantiating"></a>6.1.2. Creating an Adapter (By Injecting Dependencies)</h3></div></div></div>
<p>
            The more expressive and explicit way of creating an adapter is by injecting all your
            dependencies up front.  Zend\Db\Adapter\Adapter uses constructor injection, and all
            required dependencies are injected through the constructor, which has the following
            signature (in pseudo-code):
        </p>
<pre class="programlisting">
            use Zend\Db\Adapter\Platform\PlatformInterface,
                Zend\Db\ResultSet\ResultSet;

            class Zend\Db\Adapter\Adapter {
                public function __construct($driver, PlatformInterface $platform = null, ResultSet $queryResultSetPrototype = null)
            }
</pre>
<p>
        What can be injected:
        </p>
<p>
            $driver - an array or an instance of Zend\Db\Adapter\Driver\DriverInterface
            $platform - (optional) an instance of Zend\Db\Platform\PlatformInterface, the default will be created based off the driver implementation
            $queryResultSetPrototype - (optional) an instance of Zend\Db\ResultSet\ResultSet, to understand this object's role, see the section below on querying through the adapter
        </p>
</div>
<div class="section" title="6.1.3. Query Preparation Through Zend\Db\Adapter\Adapter::query()">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.query-preparing"></a>6.1.3. Query Preparation Through Zend\Db\Adapter\Adapter::query()</h3></div></div></div>
<p>
            By default, query() prefers that you use "preparation" as a means for processing SQL
            statements.  This generally means that you will supply a SQL statement with the values
            substituted by placeholders, and then the parameters for those placeholders are
            supplied separately.  An example of this workflow with Zend\Db\Adapter\Adapter is:
        </p>
<pre class="programlisting">
    $adapter-&gt;query('SELECT * FROM `artist` WHERE `id` = ?', array(5));
</pre>
<p>
            The above example will go through the following steps:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    create a new Statement object
                </p></li>
<li class="listitem"><p>
                    prepare an array into a ParameterContainer if necessary
                </p></li>
<li class="listitem"><p>
                    inject the ParameterContainer into the Statement object
                </p></li>
<li class="listitem"><p>
                    execute the Statement object, producing a Result object
                </p></li>
<li class="listitem"><p>
                    check the Result object to check if the supplied sql was a "query", or a result set producing statement
                </p></li>
<li class="listitem"><p>
                    if it is a result set producing query, clone the ResultSet prototype, inject Result as datasource, return it
                </p></li>
<li class="listitem"><p>
                    else, return the Result
                </p></li>
</ul></div>
</div>
<div class="section" title="6.1.4. Query Execution Through Zend\Db\Adapter\Adapter::query()">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.query-execution"></a>6.1.4. Query Execution Through Zend\Db\Adapter\Adapter::query()</h3></div></div></div>
<p>
            In some cases, you have to execute statements directly.  The primary purpose for
            needing to execute sql instead of prepare and execute a sql statement, might be
            because you are attempting to execute a DDL statement (which in most extensions
            and vendor platforms), are un-preparable.  An example of executing:
        </p>
<pre class="programlisting">
            $adapter-&gt;query('ALTER TABLE ADD INDEX(`foo_index`) ON (`foo_column`))', Adapter::QUERY_MODE_EXECUTE);
</pre>
<p>
            The primary difference to notice is that you must provide the Adapter::QUERY_MODE_EXECUTE
            (execute) as the second parameter.
        </p>
</div>
<div class="section" title="6.1.5. Creating Statements">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.statement-creation"></a>6.1.5. Creating Statements</h3></div></div></div>
<p>
            While query() is highly useful for one-off and quick querying of a
            database through Adapter, it generally makes more sense to create a
            statement and interact with it directly, so that you have greater control
            over the prepare-then-execute workflow.  To do this, Adapter gives you a
            routine called createStatement() that allows you to create a Driver
            specific Statement to use so you can manage your own prepare-then-execute workflow.
        </p>
<pre class="programlisting">
            $statement = $adapter-&gt;createStatement($sql, $optionalParameters);
            $result = $statement-&gt;execute();
</pre>
</div>
<div class="section" title="6.1.6. Using The Platform Object">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.platform"></a>6.1.6. Using The Platform Object</h3></div></div></div>
<p>
            The Platform object provides an API to assist in crafting queries in a way that
            is specific to the SQL implemetation of a particular vendor.  Nuances such
            as how identifiers or values are quoted, or what the identifier separator
            character is are handled by this object.  To get an idea of the capabilities,
            the interface for a platform object looks like this:
        </p>
<pre class="programlisting">
        interface Zend\Db\Adapter\Platform\PlatformInterface
        {
            public function getName();
            public function getQuoteIdentifierSymbol();
            public function quoteIdentifier($identifier);
            public function getQuoteValueSymbol();
            public function quoteValue($value);
            public function getIdentifierSeparator();
            public function quoteIdentifierInFragment($identifier, array $additionalSafeWords = array());
        }
</pre>
<p>
            For example, to quote a column name, specific to MySQL's way of quoting:
        </p>
<pre class="programlisting">
        $platform = new Zend\Db\Adapter\Platform\Mysql;
        $column = $platform-&gt;quoteIdentifier('first_name'); // returns `first_name`
</pre>
<p>
            Generally speaking, it is easier to get the proper Platform instance from the adapter:
        </p>
<pre class="programlisting">
        $platform = $adapter-&gt;getPlatform();
        // or
        $platform = $adapter-&gt;platform; // magic property access
</pre>
</div>
<div class="section" title="6.1.7. Using The Parameter Container">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.parameter-container"></a>6.1.7. Using The Parameter Container</h3></div></div></div>
<p>
            The ParameterContainer object is a container for the various parameters that
            need to be passed into a Statement object to fulfill all the various
            parameterized parts of the SQL statement.  This object implements the
            ArrayAccess interface.
        </p>
</div>
<div class="section" title="6.1.8. Examples">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.adapter.parameter-container.examples"></a>6.1.8. Examples</h3></div></div></div>
<p>
            Creating a Driver and Vendor portable Query, Preparing and Iterating Result
        </p>
<pre class="programlisting">
        $adapter = new Zend\Db\Adapter\Adapter($driverConfig);

        $qi = function($name) use ($adapter) { return $adapter-&gt;platform-&gt;quoteIdentifier($name); };
        $fp = function($name) use ($adapter) { return $adapter-&gt;driver-&gt;formatParameterName($name); };

        $sql = 'UPDATE ' . $qi('artist')
            . ' SET ' . $qi('name') . ' = ' . $fp('name')
            . ' WHERE ' . $qi('id') . ' = ' . $fp('id');

        /* @var $statement Zend\Db\Adapter\DriverStatementInterface */
        $statement = $adapter-&gt;query($sql);

        $parameters = array(
            'name' =&gt; 'Updated Artist',
            'id' =&gt; 1
        );

        $statement-&gt;execute($parameters);

        // DATA INSERTED, NOW CHECK

        /* @var $statement Zend\Db\Adapter\DriverStatementInterface */
        $statement = $adapter-&gt;query('SELECT * FROM '
            . $qi('artist')
            . ' WHERE id = ' . $fp('id'));

        /* @var $results Zend\Db\ResultSet\ResultSet */
        $results = $statement-&gt;execute(array('id' =&gt; 1));

        $row = $results-&gt;current();
        $name = $row['name'];
</pre>
</div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.crypt.password.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="reference.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.db.sql.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">5.4. Password secure storing </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 6.2. Zend\Db\Sql</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
