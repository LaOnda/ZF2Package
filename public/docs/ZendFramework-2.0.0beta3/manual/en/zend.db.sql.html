<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>5.2. Zend\Db\Sql</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="zend.db.html" title="Chapter 5. Zend_Db">
<link rel="prev" href="zend.db.html" title="Chapter 5. Zend_Db">
<link rel="next" href="zend.db.tablegateway.html" title="5.3. Zend\Db\TableGateway">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="article" href="learning.di.html" title="Learning Dependency Injection">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.cache.html" title="Chapter 3. Zend\Cache">
<link rel="chapter" href="zend.config.html" title="Chapter 4. Zend_Config">
<link rel="chapter" href="zend.db.html" title="Chapter 5. Zend_Db">
<link rel="chapter" href="zend.di.html" title="Chapter 6. Zend\Di">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 7. Zend\EventManager">
<link rel="chapter" href="zend.http.html" title="Chapter 8. Zend_Http">
<link rel="chapter" href="zend.loader.html" title="Chapter 9. Zend_Loader">
<link rel="chapter" href="zend.mail.html" title="Chapter 10. Zend\Mail">
<link rel="chapter" href="zend.module.html" title="Chapter 11. Zend\Module">
<link rel="chapter" href="zend.mvc.html" title="Chapter 12. Zend\Mvc">
<link rel="chapter" href="zend.uri.html" title="Chapter 13. Zend_Uri">
<link rel="chapter" href="zend.view.html" title="Chapter 14. Zend_View">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
<link rel="subsection" href="zend.db.sql.html#zend.db.sql.primary" title="5.2.1. Primary Objects: Select, Insert, Update, Delete, Where">
<link rel="subsection" href="zend.db.sql.html#zend.db.sql.where" title="5.2.2. Where, Predicates and the Fluent Interface">
<link rel="subsection" href="zend.db.sql.html#zend.db.sql.examples" title="5.2.3. Examples">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">5.2. Zend\Db\Sql</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.db.html">Prev</a> </td>
<th width="60%" align="center">Chapter 5. Zend_Db</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.db.tablegateway.html">Next</a>
</td>
</tr>
</table></div>
<div class="section" title="5.2. Zend\Db\Sql">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.db.sql"></a>5.2. Zend\Db\Sql</h2></div></div></div>
<p>
        Zend\Db\Sql is a abstraction layer for building vendor and driver specific queries.
        Zend\Db\Sql is capable of preparing a Zend\Db\Adapter Statement object, but is also
        capable of producing SQL strings.
    </p>
<div class="section" title="5.2.1. Primary Objects: Select, Insert, Update, Delete, Where">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.sql.primary"></a>5.2.1. Primary Objects: Select, Insert, Update, Delete, Where</h3></div></div></div>
<p>
            The primary objects that to interact with are:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    Zend\Db\Sql\Select - SELECT abstraction
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Insert - INSERT abstraction
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Update - UPDATE abstraction
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Delete - DELETE abstraction
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Where - WHERE abstraction to be used with Select, Update and Delete
                </p></li>
</ul></div>
<p>
            Each of these objects present their API in a fluent style, for example
            the method signature from($table) instead of setTable($table).
            To get a better understanding of the API these, these are the 4 primary
            object interfaces:
        </p>
<pre class="programlisting">

class Zend\Db\Sql\Select
{
    const JOIN_INNER = 'inner';
    const JOIN_OUTER = 'outer';
    const JOIN_LEFT = 'left';
    const JOIN_RIGHT = 'right';
    const SQL_WILDCARD = '*';

    public function __construct($table = null, $databaseOrSchema = null);

    // fluent API
    public function from($table, $databaseOrSchema = null);
    public function columns(array $columns);
    public function join($name, $on, $columns = self::SQL_WILDCARD, $type = self::JOIN_INNER);
    public function where($predicate, $combination = Predicate\PredicateSet::OP_AND);

    // methods to generate statement and/or sql
    public function prepareStatement(Adapter $adapter, StatementInterface $statement);
    public function getSqlString(PlatformInterface $platform = null);
}

class Zend\Db\Sql\Insert
{
    public function __construct($table = null, $databaseOrSchema = null);

    // fluent API
    public function into($table, $databaseOrSchema = null);
    public function columns(array $columns);
    public function values(array $values, $flag = self::VALUES_SET);

    // methods to generate statement and/or sql string
    public function prepareStatement(Adapter $adapter, StatementInterface $statement);
    public function getSqlString(PlatformInterface $platform = null);
}

class \Zend\Db\Sql\Update
{
    const VALUES_MERGE = 'merge';
    const VALUES_SET   = 'set';

    public function __construct($table = null, $databaseOrSchema = null);

    // fluent API
    public function table($table, $databaseOrSchema = null);
    public function set(array $values, $flag = self::VALUES_SET);
    public function where($predicate, $combination = Predicate\PredicateSet::OP_AND);

    // methods to generate statement and/or sql string
    public function prepareStatement(Adapter $adapter, StatementInterface $statement);
    public function getSqlString(PlatformInterface $platform = null);

}

class Zend\Db\Sql\Delete
{
    public function __construct($table = null, $databaseOrSchema = null);

    // fluent API
    public function from($table, $databaseOrSchema = null);
    public function where($predicate, $combination = Predicate\PredicateSet::OP_AND);

    // methods to generate statement and/or sql string
    public function prepareStatement(Adapter $adapter, StatementInterface $statement);
    public function getSqlString(PlatformInterface $platform = null);

}

</pre>
</div>
<div class="section" title="5.2.2. Where, Predicates and the Fluent Interface">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.sql.where"></a>5.2.2. Where, Predicates and the Fluent Interface</h3></div></div></div>
<p>
            The Zend\Db\Sql\Where object is where much of the focus of getting
            information of out a database is set upon.  A where clause in SQL is
            composed of one or many predicates.  These predicates indicate some kind
            of truth value to aid the database in selecting the proper rows
            from a set.
        </p>
<p>
            The Zend\Db\Sql\Predicate namespace is where you will find various common
            SQL predicates expressed as objects for consumption in a Where object.  The
            following is a list of currently built-in predicte objects:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\Between: Check if an identifier is between two values
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\In: Check if an identifier is in an array of values
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\IsNotNull: Check if an identifier is not null
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\IsNull: Check if an identifier is null
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\Like: Check if an identifier matches a SQL LIKE expression value
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\Literal: Use an SQL fragment exactly as typed, using ? as parameter interpoation
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\Operator - Check how a particular value compares to another value, possible operators (=, !=, &gt;, &lt;,&gt;=, &lt;=)
                </p></li>
<li class="listitem"><p>
                    Zend\Db\Sql\Predicate\PredicateSet - A nested set of additional Predicates that will be inside a SQL nest - .
                </p></li>
</ul></div>
<p>
            Zend\Db\Sql\Where\Predicate also helps expose Zend\Db\Where as a fluent API.
            Take the following example:
        </p>
<pre class="programlisting">
$where = new Zend\Db\Sql\Where();
$where-&gt;like('name', 'Ralph%')
      -&gt;OR
      -&gt;NEST
            -&gt;greaterThanOrEqualTo('age', 30)
            -&gt;AND
            -&gt;lessThanOrEqualTo('age', 50)
      -&gt;UNNEST;
</pre>
<p>
            This API is possible due to Zend\Db\Sql\Where\Predicate, who's interface looks like this:
        </p>
<pre class="programlisting">
class Zend\Db\Sql\Where\Predicate
{
    public $OR;
    public $AND;
    public $NEST;
    public $UNNSET;

    public function nest();
    public function setUnnest(Predicate $predicate);
    public function unnest();

    public function equalTo($left, $right, $leftType = self::TYPE_IDENTIFIER, $rightType = self::TYPE_VALUE);
    public function lessThan($left, $right, $leftType = self::TYPE_IDENTIFIER, $rightType = self::TYPE_VALUE);
    public function greaterThan($left, $right, $leftType = self::TYPE_IDENTIFIER, $rightType = self::TYPE_VALUE);
    public function lessThanOrEqualTo($left, $right, $leftType = self::TYPE_IDENTIFIER, $rightType = self::TYPE_VALUE);
    public function greaterThanOrEqualTo($left, $right, $leftType = self::TYPE_IDENTIFIER, $rightType = self::TYPE_VALUE);
    public function like($identifier, $like);
    public function literal($literal, $parameter);
    public function isNull($identifier);
    public function isNotNull($identifier);
    public function in($identifier, array $valueSet = array());
    public function between($identifier, $minValue, $maxValue);
}
</pre>
</div>
<div class="section" title="5.2.3. Examples">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.db.sql.examples"></a>5.2.3. Examples</h3></div></div></div>
<div class="section" title="5.2.3.1. Complex Where">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.db.sql.examples.complex-where"></a>5.2.3.1. Complex Where</h4></div></div></div>
<pre class="programlisting">
$where = new Zend\Db\Sql\Where();
$where-&gt;equalTo('id', 1)-&gt;OR-&gt;equalTo('id', 2);
echo $where-&gt;getSqlString() // WHERE "id" = '1' OR "id" = '2'

$where = new Zend\Db\Sql\Where();
$where-&gt;like('name', 'Ralph%')
      -&gt;OR
      -&gt;NEST
            -&gt;greaterThanOrEqualTo('age', 30)
            -&gt;AND
            -&gt;lessThanOrEqualTo('age', 50)
      -&gt;UNNEST;
echo $where-&gt;getSqlString() // WHERE "name" LIKE 'Ralph%' OR ("age" &gt;= '30' AND "age" &lt;= '50')
</pre>
</div>
<div class="section" title="5.2.3.2. Select Prepare">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.db.sql.examples.select"></a>5.2.3.2. Select Prepare</h4></div></div></div>
<pre class="programlisting">
use Zend\Db\Sql\Select,
    Zend\Db\ResultSet\ResultSet;

// instantiate select object
$select = new Select;
$select-&gt;from('artist')
    -&gt;join('album', 'artist.id = album.artist_id')
    -&gt;where-&gt;like('artist.name', 'Foo%');

// create a statement to use
$statment = $adapter-&gt;createStatement();

// prepare statement with $select
$select-&gt;prepareStatement($adapter, $statment);

// instantiate a result set for result-as-object iteration
$resultSet = new ResultSet();
$resultSet-&gt;setDataSource($statment-&gt;execute());

$albums = array();
foreach ($resultSet as $row) {
    $albums[] = $row-&gt;title;
}
</pre>
</div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.db.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="zend.db.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.db.tablegateway.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 5. Zend_Db </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 5.3. Zend\Db\TableGateway</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
