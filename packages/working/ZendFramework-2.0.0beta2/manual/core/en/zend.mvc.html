<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 11. Zend\Mvc</title>
<link rel="stylesheet" href="dbstyle.css" type="text/css">
<meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2">
<link rel="home" href="index.html" title="Programmer's Reference Guide">
<link rel="up" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="prev" href="zend.module.best-practices.html" title="10.5. Best Practices when Creating Modules">
<link rel="next" href="zend.mvc.quick-start.html" title="11.2. Quick Start">
<link rel="part" href="introduction.html" title="Part I. Introduction to Zend Framework">
<link rel="chapter" href="introduction.overview.html" title="Chapter 1. Overview">
<link rel="chapter" href="introduction.installation.html" title="Chapter 2. Installation">
<link rel="part" href="learning.html" title="Part II. Learning Zend Framework">
<link rel="chapter" href="learning.di.html" title="Chapter 3. Learning Dependency Injection">
<link rel="article" href="ar01.html" title="">
<link rel="part" href="reference.html" title="Part III. Zend Framework Reference">
<link rel="chapter" href="zend.cache.html" title="Chapter 4. Zend\Cache">
<link rel="chapter" href="zend.di.html" title="Chapter 5. Zend\Di">
<link rel="chapter" href="zend.event-manager.html" title="Chapter 6. Zend\EventManager">
<link rel="chapter" href="zend.http.html" title="Chapter 7. Zend_Http">
<link rel="chapter" href="zend.loader.html" title="Chapter 8. Zend_Loader">
<link rel="chapter" href="zend.mail.html" title="Chapter 9. Zend\Mail">
<link rel="chapter" href="zend.module.html" title="Chapter 10. Zend\Module">
<link rel="chapter" href="zend.mvc.html" title="Chapter 11. Zend\Mvc">
<link rel="chapter" href="zend.uri.html" title="Chapter 12. Zend_Uri">
<link rel="appendix" href="copyrights.html" title="Appendix A. Copyright Information">
<link rel="section" href="zend.mvc.html#zend.mvc.intro" title="11.1. Introduction to the MVC Layer">
<link rel="section" href="zend.mvc.quick-start.html" title="11.2. Quick Start">
<link rel="section" href="zend.mvc.routing.html" title="11.3. Routing">
<link rel="section" href="zend.mvc.mvc-event.html" title="11.4. The MvcEvent">
<link rel="section" href="zend.mvc.controllers.html" title="11.5. Available Controllers">
<link rel="section" href="zend.mvc.controller-plugins.html" title="11.6. Controller Plugins">
<link rel="section" href="zend.mvc.examples.html" title="11.7. Examples">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader"><table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 11. Zend\Mvc</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="zend.module.best-practices.html">Prev</a> </td>
<th width="60%" align="center">Part III. Zend Framework Reference</th>
<td width="20%" align="right"> <a accesskey="n" href="zend.mvc.quick-start.html">Next</a>
</td>
</tr>
</table></div>
<div class="chapter" title="Chapter 11. Zend\Mvc">
<div class="titlepage"><div><div><h1 class="title">
<a name="zend.mvc"></a>Zend\Mvc</h1></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro">11.1. Introduction to the MVC Layer</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro.basic-application-structure">11.1.1. Basic Application Structure</a></span></dt>
<dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro.basic-module-structure">11.1.2. Basic Module Structure</a></span></dt>
<dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro.bootstrapping-an-application">11.1.3. Bootstrapping an Application</a></span></dt>
<dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro.bootstrapping-a-modular-application">11.1.4. Bootstrapping a Modular Application</a></span></dt>
<dd><dl><dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro.bootstrapping-a-modular-application.configuring-the-module-manager">11.1.4.1. Configuring the Module Manager</a></span></dt></dl></dd>
<dt><span class="section"><a href="zend.mvc.html#zend.mvc.intro.conclusion">11.1.5. Conclusion</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.quick-start.html">11.2. Quick Start</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.install">11.2.1. Install the Zend Skeleton Application</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.install.using-git">11.2.1.1. Using Git</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.install.manual-installation">11.2.1.2. Manual installation</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.create-a-new-module">11.2.2. Create a new module</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.update-the-module-class">11.2.3. Update the Module class</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.create-a-controller">11.2.4. Create a Controller</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.create-a-view-script">11.2.5. Create a view script</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.create-a-route">11.2.6. Create a route</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.create-a-di-alias">11.2.7. Create a DI alias</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.tell-the-application-about-our-module">11.2.8. Tell the application about our module</a></span></dt>
<dt><span class="section"><a href="zend.mvc.quick-start.html#zend.mvc.quick-start.test-it-out">11.2.9. Test it out!</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.routing.html">11.3. Routing</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.router-types">11.3.1. Router Types</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.router-types.simple-route-stack">11.3.1.1. SimpleRouteStack</a></span></dt>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.router-types.tree-route-stack">11.3.1.2. TreeRouteStack</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types">11.3.2. Route Types</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types.hostname">11.3.2.1. Zend\Mvc\Router\Http\Hostname</a></span></dt>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types.literal">11.3.2.2. Zend\Mvc\Router\Http\Literal</a></span></dt>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types.part">11.3.2.3. Zend\Mvc\Router\Http\Part</a></span></dt>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types.regex">11.3.2.4. Zend\Mvc\Router\Http\Regex</a></span></dt>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types.scheme">11.3.2.5. Zend\Mvc\Router\Http\Scheme</a></span></dt>
<dt><span class="section"><a href="zend.mvc.routing.html#zend.mvc.routing.route-types.segment">11.3.2.6. Zend\Mvc\Router\Http\Segment</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.mvc-event.html">11.4. The MvcEvent</a></span></dt>
<dt><span class="section"><a href="zend.mvc.controllers.html">11.5. Available Controllers</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.interfaces">11.5.1. Common Interfaces Used With Controllers</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.interfaces.inject-application-event">11.5.1.1. InjectApplicationEvent</a></span></dt>
<dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.interfaces.locator-aware">11.5.1.2. LocatorAware</a></span></dt>
<dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.interfaces.pluggable">11.5.1.3. Pluggable</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.action-controller">11.5.2. The ActionController</a></span></dt>
<dd><dl><dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.action-controller.interfaces-and-collaborators">11.5.2.1. Interfaces and Collaborators</a></span></dt></dl></dd>
<dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.restful-controller">11.5.3. The RestfulController</a></span></dt>
<dd><dl><dt><span class="section"><a href="zend.mvc.controllers.html#zend.mvc.controllers.restful-controller.interfaces-and-collaborators">11.5.3.1. Interfaces and Collaborators</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.controller-plugins.html">11.6. Controller Plugins</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.controller-plugins.html#zend.mvc.controller-plugins.flashmessenger">11.6.1. The FlashMessenger</a></span></dt>
<dd><dl><dt><span class="section"><a href="zend.mvc.controller-plugins.html#zend.mvc.controller-plugins.examples">11.6.1.1. Examples</a></span></dt></dl></dd>
<dt><span class="section"><a href="zend.mvc.controller-plugins.html#zend.mvc.controller-plugins.forward">11.6.2. The Forward Plugin</a></span></dt>
<dt><span class="section"><a href="zend.mvc.controller-plugins.html#zend.mvc.controller-plugins.redirect">11.6.3. The Redirect Plugin</a></span></dt>
<dt><span class="section"><a href="zend.mvc.controller-plugins.html#zend.mvc.controller-plugins.url">11.6.4. The Url Plugin</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.examples.html">11.7. Examples</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.examples.html#zend.mvc.examples.controllers">11.7.1. Controllers</a></span></dt>
<dd><dl>
<dt><span class="section"><a href="zend.mvc.examples.html#zend.mvc.examples.controllers.accessing-the-request-and-response">11.7.1.1. Accessing the Request and Response</a></span></dt>
<dt><span class="section"><a href="zend.mvc.examples.html#zend.mvc.examples.controllers.accessing-routing-parameters">11.7.1.2. Accessing routing parameters</a></span></dt>
<dt><span class="section"><a href="zend.mvc.examples.html#zend.mvc.examples.controllers.returning-early">11.7.1.3. Returning early</a></span></dt>
</dl></dd>
<dt><span class="section"><a href="zend.mvc.examples.html#zend.mvc.examples.bootstrapping">11.7.2. Bootstrapping</a></span></dt>
<dd><dl><dt><span class="section"><a href="zend.mvc.examples.html#registering-module-specific-listeners">11.7.2.1. Registering module-specific listeners</a></span></dt></dl></dd>
</dl></dd>
</dl>
</div>
<div class="section" title="11.1. Introduction to the MVC Layer">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="zend.mvc.intro"></a>11.1. Introduction to the MVC Layer</h2></div></div></div>
<p>
    <code class="classname">Zend\Mvc</code> is a brand new MVC implementation
    designed from the ground up for Zend Framework 2.0. The focus of
    this implementation is performance and flexibility.
  </p>
<p>
    The MVC layer is built on top of the following components:
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
        <code class="classname">Zend\Di</code>, specifically its
        <code class="classname">Locator</code> interface, but by default the dependency
        injection container
      </p></li>
<li class="listitem"><p>
        <code class="classname">Zend\EventManager</code>
      </p></li>
<li class="listitem"><p>
        <code class="classname">Zend\Http</code>, specifically the request and response
        objects, which are used with:
      </p></li>
<li class="listitem"><p>
        <code class="classname">Zend\Stdlib\Dispatchable</code>; all
        "controllers" are simply dispatchable objects
      </p></li>
</ul></div>
<p>
    Within the MVC layer, several subcomponents are exposed:
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
        <code class="classname">Zend\Mvc\Router</code> contains classes pertaining to
        routing a request (the act of matching a request to a controller,
        or dispatchable)
      </p></li>
<li class="listitem"><p>
        <code class="classname">Zend\Mvc\PhpEnvironment</code>, a set of decorators for
        the HTTP <code class="classname">Request</code> and <code class="classname">Response</code>
        objects that ensure the request is injected with the current
        environment (including query parameters, POST parameters, HTTP
        headers, etc.)
      </p></li>
<li class="listitem"><p>
        <code class="classname">Zend\Mvc\Controller</code>, a set of abstract
        "controller" classes with basic responsibilities such as
        event wiring, action dispatching, etc.
      </p></li>
</ul></div>
<p>
    The gateway to the MVC is the
    <code class="classname">Zend\Mvc\Application</code> object (referred to simply
    as <code class="classname">Application</code> from this point forward). Its
    primary responsibilities are to <span class="emphasis"><em>route</em></span> the
    request, and to retrieve and <span class="emphasis"><em>dispatch</em></span> the
    controller discovered. Once accomplished, it returns a response,
    which can then be <span class="emphasis"><em>sent</em></span>.
  </p>
<div class="section" title="11.1.1. Basic Application Structure">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.mvc.intro.basic-application-structure"></a>11.1.1. Basic Application Structure</h3></div></div></div>
<p>
      The basic structure of an application is as follows:
    </p>
<div class="literallayout"><p><br>
application_root/<br>
    config/<br>
        application.config.php<br>
    data/<br>
    module/<br>
    vendor/<br>
    public/<br>
        .htaccess<br>
        index.php<br>
</p></div>
<p>
      The <code class="filename">public/index.php</code> performs the basic work of
      martialling configuration and configuring the
      <code class="classname">Application</code>. Once done, it
      <code class="methodname">run()</code>s the <code class="classname">Application</code> and
      <code class="methodname">send()</code>s the response returned.
    </p>
<p>
      The <code class="filename">config</code> directory will typically contain
      configuration used by <code class="classname">Zend\Module\Manager</code> in
      order to load modules and merge configuration; we will detail this
      more later.
    </p>
<p>
      The <code class="filename">vendor</code> subdirectory should contain any
      third-party modules or libraries on which your application depends. This
      might include Zend Framework, custom libraries from your organization, or
      other third-party libraries from other projects. Libraries and modules
      placed in the <code class="filename">vendor</code> subdirectory should not be
      modified from their original, distributed state.
    </p>
<p>
      Finally, the <code class="filename">module</code> directory will contain one
      or more modules delivering your application's functionality.
    </p>
<p>
      Let's now turn to modules, as they are the basic units of a web
      application.
    </p>
</div>
<div class="section" title="11.1.2. Basic Module Structure">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.mvc.intro.basic-module-structure"></a>11.1.2. Basic Module Structure</h3></div></div></div>
<p>
      A module may contain just about anything: PHP code, including MVC
      functionality; library code; view scripts; and/or or public assets
      such as images, CSS, and JavaScript. The one requirement -- and
      even this is optional -- is that a module acts as a PHP namespace
      and that it contains a <code class="classname">Module</code> class under that
      namespace. This class will then be consumed by
      <code class="classname">Zend\Module\Manager</code> in order to perform a number
      of tasks.
    </p>
<p>
      The recommended structure of a module is as follows:
    </p>
<div class="literallayout"><p><br>
module_root/<br>
    Module.php<br>
    autoload_classmap.php<br>
    autoload_function.php<br>
    autoload_register.php<br>
    config/<br>
        module.config.php<br>
    public/<br>
        images/<br>
        css/<br>
        js/<br>
    src/<br>
        &lt;module_namespace&gt;/<br>
            &lt;code files&gt;<br>
    tests/<br>
        phpunit.xml<br>
        bootstrap.php<br>
        &lt;module_namespace&gt;/<br>
            &lt;test code files&gt;<br>
    views/<br>
        &lt;dir-named-after-a-controller/<br>
            &lt;.phtml files&gt;<br>
</p></div>
<p>
      Since a module acts as a namespace, the module root directory
      should be that namespace. Typically, this namespace will also
      include a vendor prefix of sorts. As an example a module centered
      around "User" functionality delivered by Zend might be
      named "ZendUser", and this is also what the module root
      directory will be named.
    </p>
<p>
      The <code class="filename">Module.php</code> file directly under the module
      root directory will be in the module namespace.
    </p>
<pre class="programlisting">
namespace ZendUser;

class Module
{
}
</pre>
<p>
      By default, if an <code class="methodname">init()</code> method is defined, this
      method will be triggered by a <code class="classname">Zend\Module\Manager</code>
      listener when it loads the module class, and passed an instance of the
      manager. This allows you to perform tasks such as setting up
      module-specific event listeners. The <code class="methodname">init()</code>
      method is called for <span class="emphasis"><em>every</em></span> module on
      <span class="emphasis"><em>every</em></span> page request and should
      <span class="emphasis"><em>only</em></span> be used for performing
      <span class="emphasis"><em>lightweight</em></span> tasks such as registering event
      listeners.
    </p>
<p>
      The three <code class="filename">autoload_*.php</code> files are not
      required, but recommended. They provide the following:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
          <code class="filename">autoload_classmap.php</code> should return an array
          classmap of class name/filename pairs (with the filenames resolved
          via the <code class="varname">__DIR__</code> magic constant).
        </p></li>
<li class="listitem"><p>
          <code class="filename">autoload_function.php</code> should return a PHP
          callback that can be passed to
          <code class="methodname">spl_autoload_register()</code>. Typically, this
          callback should utilize the map returned by
          <code class="filename">autoload_filemap.php</code>.
        </p></li>
<li class="listitem"><p>
          <code class="filename">autoload_register.php</code> should register a PHP
          callback (typically that returned by
          <code class="filename">autoload_function.php</code> with
          <code class="methodname">spl_autoload_register()</code>.
        </p></li>
</ul></div>
<p>
      The point of these three files is to provide reasonable default
      mechanisms for autoloading the classes contained in the module,
      thus providing a trivial way to consume the module without
      requiring <code class="classname">Zend\Module</code> (e.g., for use outside a
      ZF2 application).
    </p>
<p>
      The <code class="filename">config</code> directory should contain any
      module-specific configuration. These files may be in any format
      <code class="classname">Zend\Config</code> supports. We recommend naming the main
      configuration "module.format", and for PHP-based configuration,
      "module.config.php". Typically, you will create configuration for the
      router as well as for the dependency injector.
    </p>
<p>
      The <code class="filename">src</code> directory should be a
      <a class="link" href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md" target="_top">PSR-0 compliant directory structure</a>
      with your module's source code. Typically, you should at least have
      one subdirectory named after your module namespace; however, you
      can ship code from multiple namespaces if desired.
    </p>
<p>
      The <code class="filename">tests</code> directory should contain your unit
      tests. Typically, these will be written using
      <a class="link" href="http://phpunit.de" target="_top">PHPUnit</a>, and contain
      artifacts related to its configuration (e.g.,
      <code class="filename">phpunit.xml</code>, <code class="filename">bootstrap.php</code>).
    </p>
<p>
      The <code class="filename">public</code> directory can be used for assets that
      you may want to expose in your application's document root. These
      might include images, CSS files, JavaScript files, etc. How these
      are exposed is left to the developer.
    </p>
<p>
      The <code class="filename">views</code> contains view scripts related to your
      controllers.
    </p>
</div>
<div class="section" title="11.1.3. Bootstrapping an Application">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.mvc.intro.bootstrapping-an-application"></a>11.1.3. Bootstrapping an Application</h3></div></div></div>
<p>
      An <code class="classname">Application</code> composes several objects, but the
      ones of particular interest to the developer are the Router and the
      Locator. These will always need to be configured and injected in
      order for the <code class="classname">Application</code> to run. Thus,
      bootstrapping consists of configuring and injecting the router, as
      well as the locator.
    </p>
<p>
      Zend Framework ships a default bootstrap implementation in
      <code class="classname">Zend\Mvc\Bootstrap</code>. This class accepts an
      instance of <code class="classname">Zend\Config\Config</code> to its constructor;
      once you have an instance, you then call its
      <code class="methodname">bootstrap()</code> method, passing it the
      <code class="classname">Application</code> instance. It will then configure your
      locator (using <code class="classname">Zend\Di\Di</code> by default) and your
      router (using <code class="classname">Zend\Mvc\Router\Http\TreeRouteStack</code>
      by default).
    </p>
<p>
      Once those two tasks are accomplished, it then triggers a "bootstrap"
      event on its attached <code class="classname">EventManager</code> instance. This
      allows your modules to attach listeners, and thus perform additional, 
      module-specific, bootstrapping tasks (which might include registering
      ACLs, setting up cache or log listeners, etc.).
    </p>
<p>
      Usage would then be as follows:
    </p>
<pre class="programlisting">
// Assuming $config is the merged config from all modules
$bootstrap   = new Bootstrap($config);
$application = new Application();
$bootstrap-&gt;bootstrap($application);
</pre>
<p>
      At this point, your <code class="classname">Application</code> would be ready
      to run:
    </p>
<pre class="programlisting">
$response = $application-&gt;run();
$response-&gt;send();
</pre>
<p>
      The <code class="methodname">run()</code> method does basically four things:
    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
          It martials the <code class="classname">Request</code> object, ensuring that it
          is fully configured based on the current request environment (this
          includes injecting headers, query and POST parameters, and more).
        </p></li>
<li class="listitem"><p>
          It triggers a "route" event. By default, the
          <code class="methodname">route()</code> method of the
          <code class="classname">Application</code> is registered as a listener, but you
          can provide your own listeners to either replace it or intercept
          before or after it executes.
        </p></li>
<li class="listitem"><p>
          It triggers a "dispatch" event. By default, the
          <code class="methodname">dispatch()</code> method of the
          <code class="classname">Application</code> is registered as a listener, but you
          can provide your own listeners to either replace it or intercept
          before or after it executes.
        </p></li>
<li class="listitem"><p>
          It martials a <code class="classname">Response</code> object capable of sending
          itself from the return values of the "dispatch" event.
        </p></li>
</ul></div>
<p>
      You'll note that you have a great amount of control over the
      workflow. Using the EventManager's priority system, you can
      intercept the "route" and "dispatch" events
      anywhere during execution, allowing you to craft your own
      application workflows as needed.
    </p>
</div>
<div class="section" title="11.1.4. Bootstrapping a Modular Application">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.mvc.intro.bootstrapping-a-modular-application"></a>11.1.4. Bootstrapping a Modular Application</h3></div></div></div>
<p>
      While the previous approach largely works, where does the
      configuration come from? When we create a modular application, the
      assumption will be that it's from the modules themselves. How do we
      get that information and aggregate it, then?
    </p>
<p>
      The answer is via <code class="classname">Zend\Module\Manager</code>. This
      component allows you to specify where modules exist, and it will
      then locate each module and initialize it. If a module's
      <code class="classname">Module</code> class has a
      <code class="methodname">getConfig()</code> method, it will retrieve its
      configuration and merge it with the application configuration.
      Sound complicated? It's not.
    </p>
<div class="section" title="11.1.4.1. Configuring the Module Manager">
<div class="titlepage"><div><div><h4 class="title">
<a name="zend.mvc.intro.bootstrapping-a-modular-application.configuring-the-module-manager"></a>11.1.4.1. Configuring the Module Manager</h4></div></div></div>
<p>
          The first step is configuring the module manager. The easiest way to
          do this is to utilize the provided
          <code class="classname">Zend\Module\Listener\DefaultListenerAggregate</code>.
          Then you simply inform the module manager which modules to load and
          attach the listener aggregate.
      </p>
<p>
        Remember the <code class="filename">application.config.php</code> from
        earlier? We're going to provide some configuration.
      </p>
<pre class="programlisting">
&lt;?php
// config/application.config.php
return array(
    'modules' =&gt; array(
        /* ... */
    ),
    'module_listener_options' =&gt; array( 
        'module_paths' =&gt; array(
            './module',
            './vendor',
        ),
    ),
);
</pre>
<p>
        As we add modules to the system, we'll add items to the
        <code class="varname">modules</code> array.
      </p>
<p>
        Now, within our <code class="filename">public/index.php</code>, we can setup
        the <code class="classname">DefaultListenerAggregate</code>:
      </p>
<pre class="programlisting">
use Zend\Module\Listener;

$moduleConfig     = include __DIR__ . '/../configs/application.config.php';
$listenerOptions  = new Listener\ListenerOptions($moduleConfig['module_listener_options']);
$defaultListeners = new Listener\DefaultListenerAggregate($listenerOptions);
</pre>
<p>
        Once we have that out of the way, we can instantiate our module
        manager:
      </p>
<pre class="programlisting">
use Zend\Module\Manager as ModuleManager;

$moduleManager = new ModuleManager(
    $moduleConfig['modules']
);
$moduleManager-&gt;events()-&gt;attachAggregate($defaultListeners);
</pre>
<p>
        Each <code class="classname">Module</code> class that has configuration it wants
        the <code class="classname">Application</code> to know about should define a
        <code class="methodname">getConfig()</code> method. That method should return
        an array or <code class="classname">Traversable</code> object such as
        <code class="classname">Zend\Config\Config</code>. As an example:
      </p>
<pre class="programlisting">
namespace ZendUser;

class Module
{
    public function getConfig()
    {
        return include __DIR__ . '/config/module.config.php'
    }
}
</pre>
</div>
</div>
<div class="section" title="11.1.5. Conclusion">
<div class="titlepage"><div><div><h3 class="title">
<a name="zend.mvc.intro.conclusion"></a>11.1.5. Conclusion</h3></div></div></div>
<p>
      The ZF2 MVC layer is incredibly flexible, offering an opt-in, easy
      to create modular infrastructure, as well as the ability to craft
      your own application workflows via the EventManager system.
      Bootstrapping, while largely left to the developer, is
      straight-forward and provides a simple methodology for configuring
      the application and informing it of the various routes and services
      in play. The module manager is a lightweight and simple approach to
      enforcing a modular architecture that encourages clean separation
      of concerns and code re-use.
    </p>
</div>
</div>
</div>
<div class="navfooter"><table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="zend.module.best-practices.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="reference.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="zend.mvc.quick-start.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">10.5. Best Practices when Creating Modules </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> 11.2. Quick Start</td>
</tr>
</table></div>
<div class="revinfo"></div>
</body>
</html>
